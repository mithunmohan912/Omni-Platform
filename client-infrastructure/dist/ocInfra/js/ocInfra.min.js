"use strict";function AnonymousController(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.screenId="anonymous";var p=b.metadataPath;l.load(a,p),a.checkvisible=function(b){return j.checkVisibility(b,a)},b.showHeader=!1,a.doaction=function(c,d,e,f){if("login"===c)b.nextURL=f,b.navigate(f);else if("navigate"===c){if(b.nextURL=f,b.navigate(f),void 0===b.regionId){var g=f.split("/");b.regionId=g[1]}new Promise(function(c){m.actionHandling(a,b.regionId,b.screenId,"create",o,void 0,c)}).then(function(){n.loadEnumerationByTab()})}},b.navigate=function(a){c.path(a)},a.submit=function(b){var c=$("form").attr("id");validateLogin(c),$("#"+c).valid()&&(navigator.onLine?i.runLogin(a,b):showMessage("Network is not available","30"))}}function OCController(a,b,c,d,e,f,g,h){b.showHeader=!0;var i=null;-1!==c.screenId.indexOf(":")?(i=c.screenId.split(":"),b.screenId=i[1]):(i=c.screenId,b.screenId=i);var j=b.config.templates.metaData;h.load(a,j),a.checkvisible=function(b){return g.checkVisibility(b,a)},a.doaction=function(b,c,d,e){"navigate"===b&&a.navigate(e)},b.navigate=function(a){d.path(a)}}function showHostErrorMessage(a,b){var c=$("#errorPopup");c.removeClass("alert-error"),c.removeClass("alert-warning"),c.removeClass("alert-info"),"30"===b?c.addClass("alert-error"):"20"===b?c.addClass("alert-remove"):c.addClass("alert-info"),$("#errorMessage").html(a),$("#errorPopup").show()}function loadOptions(a,b,c,d,e,f){var g,h,i=b.metadata[d];void 0!==i&&(h=i.resourcelist),void 0!==h&&h.length>0&&loadOptionsDataForMetadata(h,b,c,e,f,g)}function loadOptionsDataForMetadata(a,b,c,d,e,f,g,h){return void 0!==a&&a.length>0&&angular.forEach(a,function(a){console.log("RESOURCE : "+a);var i;i=e.resourceHref?e.resourceHref:b.HostURL+a;var j=b.regionToSoR,k=j[c],l=i.replace(":regionId",k),m=c+":"+a;void 0===b.optionsMap&&(b.optionsMap=[]);var n=b.optionsMap[m];"update"===f&&void 0!==g&&(n=void 0),void 0===n&&(n=new Map,d.options(l,e.headers).success(function(a){var c,i=a._options.links;if(void 0!==g){var j=a._links[g];if(void 0!==j){var k=j.href;d.options(k,e.headers).success(function(a){var g=a._links.item.href;d.options(g,e.headers).success(function(a){i=a._options.links,setOptionsMapForResource(i,n),b.optionsMap[m]=n,void 0!==f&&(c=n.get(f),httpMethodToBackEnd(b,d,e,c,h))})})}else setOptionsMapForResource(i,n),b.optionsMap[m]=n,void 0!==f&&(c=n.get(f),httpMethodToBackEnd(b,d,e,c,h))}else setOptionsMapForResource(i,n),b.optionsMap[m]=n,void 0!==f&&(c=n.get(f),httpMethodToBackEnd(b,d,e,c,h))}))}),"success"}function setOptionsMapForResource(a,b){angular.forEach(a,function(a){var c={};c.action=a.rel,c.url=a.href,c.httpmethod=a.method,c.schema=a.schema,console.log("ACTION : "+c.action),console.log("HTTP METHOD : "+c.httpmethod),console.log("URL : "+c.url),console.log("SCHEMA : "+c.schema),void 0!==b.get(c.action)?b.set(c.action+"1",c):b.set(c.action,c)})}function httpMethodToBackEnd(a,b,c,d,e){var f=d.url,g=d.httpmethod,h=d.schema;console.log("Perform "+g+" operation on URL - "+f+" with following params - ");var i={};i=setData(a,h,i),"GET"===g?b.get(f,i,c.headers).success(function(a){var b=angular.element($(".table-striped")).scope();a._links.item?(b.stTableList=a._links.item,b.showResult=!0):(b.stTableList=[],b.showResult=!1)}):"POST"===g?b.post(f,i,c.headers).success(function(a){a&&(c.resourceHref=a._links.self.href,console.log("Quote ID:"+a["quote-doc-id"]),showMessage("Successfully created !!"),e&&e())}):"PATCH"===g&&b.patch(f,i,c.headers).success(function(a){a&&e&&e()})}function loadReferencedMetaModels(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=[];m=k?"assets/resources/metadata/regions/"+k+"/":"assets/resources/metadata/",angular.forEach(b.include,function(a){n.push(g(m+a+".json").get(function(b){i.metadata[a]=b.metadata},function(){i.showIcon=!1,showMessage(i.appConfig.timeoutMsg)}).$promise)}),h.all(n).then(function(){setScreenData(i,a,b,c,j,d,f,l)})}function setScreenData(a,b,c,d,e,f,g,h){var i=c.metadata,j=i.resourcelist;void 0!==j&&j.length>0&&angular.forEach(j,function(a){b.metadata[a]=c.metadata}),b.metadata[d]=c.metadata,e.notifyWhenNoOutstandingRequests(function(){changeMandatoryColor(a),a.$apply()}),g&&g(c.metadata),h&&h()}function setData(a,b,c){return angular.forEach(b.properties,function(b,d){var e=a.data[d],f=b.type;if(void 0!==f&&"static"===f&&(e=b.value),null===e||void 0===e||""===e||"undefined"===e);else{var g=b.format;void 0!==g&&"date"===g&&(e=formatIntoDate(e)),"object"==typeof e&&(e=void 0!==e.key?e.key:e.value),console.log(d+" : "+e),c[d]=e}}),c}function formatIntoDate(a){return"string"==typeof a?a:a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}function changeMandatoryColor(a){void 0!==a.screenId&&($("#"+a.metadata[a.screenId].formid+" input[ng-required='true']").css("background-color",a.requiredColor),$("#"+a.metadata[a.screenId].formid+" select[ng-required='true']").css("background-color",a.requiredColor))}function LoginController(a,b,c,d,e,f,g,h,i,j,k,l){b.screenId="login";var m=b.metadataPath;l.load(a,m),a.checkvisible=function(b){return j.checkVisibility(b,a)},b.showHeader=!1,a.doaction=function(b,c,d,e,f){"submit"===b&&a.submit(f)},a.submit=function(b){var c=$("form").attr("id");validateLogin(c),$("#"+c).valid()&&(navigator.onLine?i.runLogin(a,b):showMessage("Network is not available","30"))}}function ScreenController(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){var c=!0;return c=b.data[a.field]===a.value}function o(a){var b=c.metadata[c.screenId].sections;angular.forEach(b,function(b){a===b.step&&(c.currRel=b.link)})}c.enumData={},c.optionsMap=[],b.checkRegionId=c.regionId,b.showErr=function(){h.addErrorMessage("<b>Error:</b> Uh oh!"),h.addInfoMessage("Im  a info message"),h.addWarnMessage("Im  a warn message"),h.addSuccessMessage("Im  a success message")},screenname="Omnichannel",c.showHeader=!0,b.disableNext=!1;var p={};b.rulesDataList=[];var q=null,r=null,s=!1,t=!1;b.data={},b.remove="ban-circle",b.removestyle="red",b.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"1900:2030"},c.typeahead=[],void 0!==f.regionId&&f.regionId.length>0&&(-1!==f.regionId.indexOf(":")?(r=f.regionId.split(":"),c.regionId=r[1],t=!0):(r=f.regionId,c.regionId=r)),-1!==f.screenId.indexOf(":")?(q=f.screenId.split(":"),c.screenId=q[1],s=!0):(q=f.screenId,c.screenId=q),-1!==f.screenId.indexOf("search")&&(c.resourceHref=void 0),c.navigate=function(a,b){c.product_id=b,g.path(a)},b.getEnums=function(a){return c&&c.enumData&&c.enumData[a.name]?c.enumData[a.name]:a.options?a.options:void 0},i.setHeaders(c),b.loadTableMetadata=function(a){b.field={},l.load(a.name,function(a){b.field.tableMetaData=a})},c.navigate=function(a,b){c.product_id=b,g.path(a)},b.checkvisible=function(a){if(a.visibleWhen){var b=n(a.visibleWhen.expression);return b}return!0},b.loadMetaData=function(){c.metadata={},i.load(b,t?r[1]:r,s?q[1]:q,p),p&&b.loadData()},b.loadData=function(){if(c.isPrev)return b.data=angular.copy(c.allData),b.disableNext=!1,!0;var a=c.resourceHref;void 0!==a&&(j.options(a,c.headers,b),j.get(a,c.headers,b))},b.Injectfactory=function(){b.factoryname=b.screenId+"factory";try{b.factory=e.get(b.factoryname)}catch(a){console.log("Injector does not have "+b.factoryname+" service!")}},c.isPrev=!1,b.loadOptionData=function(){var a=c.resourceHref;void 0===a&&(a=c.HostURL+b.screenId)},b.loadOptionData(),b.doaction=function(a,d,e,f,g){console.log(g);var j,l=c.screenId,n=c.regionId;"get"===e?(j=c.HostURL+l,b.factory.get(j)):"delete"===e?(j=c.HostURL+"quotes",k["delete"](j,d.id).success(function(a){h.addSuccessMessage(a.message)})):"add"===e?(c.navigate(f),new Promise(function(a){i.actionHandling(b,n,l,"create",k,void 0,a)}).then(function(){m.loadEnumerationByTab()})):"calculate"===e?new Promise(function(a){i.actionHandling(b,n,l,"update",k,"quote:quote_risk_list",a)}).then(function(){var a=c.resourceHref+"/operations/tariff_calculation/execute",d={};k.post(a,d,c.headers).success(function(a){var e;e=Array.isArray(a.messages)?a.messages[1].message[0]:a.messages.context,k.get(e,d,c.headers).success(function(a){b.data=a,console.log("Compute successfully !!")})})}):i.actionHandling(b,n,l,e,k)},b.deleteRow=function(a){var b=angular.element($(".table-striped")).scope(),c=a._link.self.href,d="";k["delete"](c,d);var e=0;angular.forEach(b.stTableList,function(c){c.$$hashKey===a.$$hashKey&&b.stTableList.splice(e),e+=1})},c.next=function(){b.next()},b.next=function(){},c.step=1,b.getenumdata=function(){var a="https://oc-sample-dropdown.getsandbox.com/omnichannel/sample/select";k.getData(a).success(function(a){b.enumdata=a})},b.preStep=1,b.preRel=void 0,c.currRel=void 0,new Promise(function(a){i.load(b,t?r[1]:r,s?q[1]:q,p,void 0,void 0,a)}).then(function(){o(b.preStep),m.loadEnumerationByTab(),"undefined"!==c.currRel&&"itself"!==c.currRel?b.loadDataByTab(c.currRel):(j.get(c.resourceHref,c.headers,b),m.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create"))}),b.selecttab=function(a,d){var e=c.screenId,f=c.regionId;c.step=a,c.currRel=d,new Promise(function(a){c.step!==b.preStep&&"undefined"!==d?(o(b.preStep),i.actionHandling(b,f,e,"update",k,b.currRel,a)):j.get(c.resourceHref,c.headers,b),b.preStep=c.step,o(b.preStep)}).then(function(){"undefined"!==c.currRel&&"itself"!==c.currRel?b.loadDataByTab(c.currRel):(j.get(c.resourceHref,c.headers,b),m.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create"))})},b.loadDataByTab=function(a){var d=c.resourceHref;void 0!==d&&k.options(d,c.headers).success(function(d){var e=d._links[a].href;k.options(e,c.headers).success(function(a){var d=a._links.item.href;j.get(d,c.headers,b),m.executeEnumerationFromBackEnd(d,c.headers,"update")})})}}function showMessage(a){$("#messageID").html(a),$("#popupdiv").modal("show")}function validateLogin(a){$("#"+a).validate({focusInvalid:!1,onkeyup:!1,onclick:!1,focusCleanup:!1,onfocusout:!1,onfocus:!1,onsubmit:!1,rules:{inputUsername:{required:!0},inputPassword:{required:!0}},messages:{inputUsername:"Username and Password are required.",inputPassword:"Username and Password are required."},errorPlacement:function(a,b){$("#"+b.attr("id")).addClass("highlight")}})}LoginController.$inject=["$scope","$rootScope","$location","$cookieStore","$http","$resource","OCRoles","tmhDynamicLocale","LoginSrv","FieldService","OCInfraConfig","OCMetadata"],ScreenController.$inject=["$http","$scope","$rootScope","$controller","$injector","$routeParams","$location","growl","MetaData","HttpService","dataFactory","TableMetaData","EnumerationService"];var app=angular.module("omnichannel",["ngRoute","ngResource","ui.bootstrap","ngSanitize","ui.select","mgcrea.ngStrap","ngLocale","tmh.dynamicLocale","colorpicker.module","smart-table","ui.date","ui.mask","QuickList","ngCookies","angular-growl"]).config(["$routeProvider","$locationProvider","$httpProvider","tmhDynamicLocaleProvider","growlProvider",function(a,b,c,d,e){e.globalTimeToLive(3e3),e.globalEnableHtml(!0),e.onlyUniqueMessages(!0),a.when("/",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/login",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/:screenId",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:ScreenController}),d.localeLocationPattern("vendors/angular-i18n/angular-locale_{{locale}}.js")}]);app.run(["$rootScope","$location","$cookieStore","OCInfraConfig",function(a,b,c,d){a.$on("$locationChangeStart",function(){null!==c.get("userid")&&void 0!==c.get("userid")||b.url("/")}),a.showHeader=!1,d.load()}]),app.directive("ocLogodir",function(){return{restrict:"E",template:'<div class="oc-logo" style="margin-left: auto;margin-right: auto;"></div>'}}),app.factory("MetaData",["$resource","$rootScope","$location","$browser","$q","dataFactory",function(a,b,c,d,e,f){return this.load=function(c,g,h,i,j,k,l){var m;c.regionId=g,m=g?"assets/resources/metadata/regions/"+g+"/"+h+".json":"assets/resources/metadata/"+h+".json",a(m).get(function(m){c.screenId=h,b.title=m.metadata.title,m.include&&m.include.length>0?loadReferencedMetaModels(c,m,h,i,j,k,a,e,b,d,g,l):setScreenData(b,c,m,h,d,i,k),loadOptions(m,c,g,h,f,b)},function(){b.showIcon=!1,showMessage(b.appConfig.timeoutMsg)})},this.actionHandling=function(a,c,d,e,f,g,h){var i=a.metadata[d],j=i.resourcelist;void 0!==j&&j.length>0&&angular.forEach(j,function(d){var i=c+":"+d;void 0===a.optionsMap&&(a.optionsMap=[]);var k=a.optionsMap[i];if(console.log("SCREEN ACTION-"+e),"update"===e&&void 0!==g&&(k=void 0),void 0===k)loadOptionsDataForMetadata(j,a,c,f,b,e,g,h);else{var l=k.get(e);httpMethodToBackEnd(a,f,b,l,h)}})},this.setHeaders=function(a){a.headers={Accept:"application/json","Content-Type":"application/json","x-IBM-Client-id":"f9220738-65e5-432d-9b8f-05e8357d1a61","x-IBM-Client-Secret":"gT1lS3aV8yS1iS3lY3kB7bL8pH0cH6nJ6yT4jH1aQ6pL8aR6hI"},a.user&&a.user.name&&(a.headers.username=a.user.name)},this}]),app.factory("TableMetaData",["$resource","$rootScope",function(a,b){return this.load=function(c,d){a("assets/resources/metadata/table/"+b.regionId+"/"+c+".json").get(function(a){d&&d(a.tableMetaData)},function(){})},this}]),app.controller("HeaderController",["$scope","$rootScope","$http","$location","$cookieStore","$resource","tmhDynamicLocale",function(a,b,c,d,e,f,g){b.logout=function(){delete b.user,delete localStorage.username,delete c.defaults.headers.common.Authentication,localStorage.clear(),sessionStorage.clear(),e.remove("userid"),b.staticInfo={},d.url("/")},a.setLocate=function(a){b.newlocale=a,angular.forEach(b.localeOpts.options,function(a){a.value===b.newlocale&&(b.selectedLanguage=a.description)}),f("ocInfra/assets/resources/i18n/"+a+".json").get(function(c){b.locale=c,g.set(a)},function(){})}}]),app.service("LoginSrv",["$rootScope","$resource","$cookieStore","$http","OCRoles","tmhDynamicLocale",function(a,b,c,d,e,f){this.runLogin=function(g,h){a.showIcon=!0,d({url:"ocInfra/assets/resources/config/users.json",method:"GET"}).success(function(d){var i=[];if(a.isAuthSuccess=!1,angular.forEach(d.users,function(b){b.name===g.data.inputUsername&&b.password===g.data.inputPassword&&(a.isAuthSuccess=!0,i=b)}),!a.isAuthSuccess)return showMessage("Check Username or Password, incorrect Credentials !"),!1;a.user=i,localStorage.username=i.name,localStorage.distributorId=i.distributor_id,c.put("userid",localStorage.username),localStorage.Authentication=i.token;var j=i.personalizationData.locale;a.newlocale=j,b("ocInfra/assets/resources/i18n/"+a.newlocale+".json").get(function(b){a.locale=b,f.set(a.newlocale),e.load(i.roles[0],h)},function(){})}).error(function(b){a.showIcon=!1,b&&b.exception?showMessage(b.exception.message,"30"):showMessage("Unable to connect the server. Please check your internet connection or contact system admin.")})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.factory("dataFactory",["$http",function(a){var b={};return b.getData=function(b){return a.get(b)},b.get=function(b,c,d){var e=a({method:"GET",url:b,params:c,headers:d});return e},b.post=function(b,c,d){var e=a({method:"POST",url:b,headers:d,data:c});return e},b.insert=function(b,c){return a.post(b,c)},b.update=function(b,c){return a.put(b+"/"+c.id,c)},b["delete"]=function(b,c){return a["delete"](b+"/"+c)},b.options=function(b,c){var d=a({method:"GET",url:b,headers:c});return d},b.patch=function(b,c,d){var e=a({method:"PATCH",url:b,headers:d,data:c});return e},b}]);var screenname;app.service("OCInfraConfig",["$resource","$rootScope",function(a,b){this.load=function(){b.infraConfig={},a("ocInfra/assets/resources/config/OCInfraConfig.json").get(function(a){b.infraConfig=a.config.base,b.metadataPath=a.config.base.templates.metaData,angular.forEach(b.infraConfig.properties,function(a){"language"===a.name&&(b.localeOpts=angular.fromJson('{"options":'+angular.toJson(a.options)+"}"),angular.forEach(b.localeOpts.options,function(a){a.description=a.description}))})})}}]),app.service("FieldService",function(){this.checkVisibility=function(a,b){return a.visibleWhen?b.data[a.visibleWhen.expression.field]===a.visibleWhen.expression.value?!0:void 0:!0}}),app.service("OCMetadata",["$rootScope","$resource",function(a,b){this.load=function(c,d){var e=a.screenId,f=d+e+".json";a.metadata={},c.data={},b(f).get(function(b){a.metadata[e]=b.metadata,a.title=b.metadata.title,c.screenId=e})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.service("HttpService",["$http","DataMappingService","growl",function(a,b,c){return this.options=function(b,c,d){a({method:"OPTIONS",url:b,headers:c}).success(function(a){angular.forEach(a,function(a){Array.isArray(a)&&(void 0===d.optionData&&(d.optionData=[]),d.optionData[b]=a)})})},this.search=function(b,c,d,e){a({method:"GET",url:b,headers:c,params:d}).success(function(a){a.item?(e.stTableList=a.item,e.showResult=!0):(e.stTableList=[],e.showResult=!1)})},this.get=function(c,d,e){a({method:"GET",url:c,headers:d}).success(function(a){a&&(e.data=a,console.log("DataMappingService"+b),void 0!==b&&b.map(e))})},this.addUpdate=function(b,d,e,f,g){a({method:b,url:d,headers:e,data:f}).success(function(a){if(a){var d=g.charAt(0).toUpperCase()+g.substring(1);console.log(d),"PATCH"===b?c.addSuccessMessage(a.message):c.addSuccessMessage(a.message)}})},this}]),app.service("EnumerationService",["$rootScope","dataFactory",function(a,b){var c=this;c.loadEnumerationByTab=function(){if(a.resourceHref&&a.currRel)if("itself"===a.currRel){var d=a.resourceHref;c.executeEnumerationFromBackEnd(d,a.headers,"update")}else b.options(a.resourceHref,a.headers).success(function(d){var e=d._links[a.currRel].href;b.options(e,a.headers).success(function(b){var d=b._links.item.href;c.executeEnumerationFromBackEnd(d,a.headers,"update")})})},c.executeEnumerationFromBackEnd=function(c,e,f){b.options(c,e).success(function(b){angular.forEach(b._options.links,function(b){b.rel===f&&angular.forEach(b.schema.properties,function(b,c){b["enum"]&&d(a,b["enum"],c)})})})};var d=function(a,b,c){var d={},f=null;b?(d[c]=e(b),angular.extend(a.enumData,d)):d[c]=a.enumData[c],d[f]=d[c],angular.extend(a.enumData,d)},e=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b};return c}]),app.controller("TableController",["$browser","$scope","$rootScope","TableMetaData","$location",function(a,b,c,d,e){b.showResult=!0,b.riskDataSet=[],c.rowCollection={},b.loadTableMetadata=function(){d.load(b.field.name,function(a){b.field.tableMetaData=a})},b.checkShow=function(a){return void 0===a.visibleflag?!0:void 0===c.config[a.visibleflag]||c.config[a.visibleflag]===!0},b.doActionItem=function(a,d,e,f){var g;"edit"===a?(c.resourceHref=d.href,c.navigate(f)):"delete"===a&&(g=angular.element($("#"+e)).scope().field,b.deleteRow(d,g))},b.loadTableMetadata(),b.editItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},b.selectItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},c.navigate=function(a){e.path(a)}}]);