"use strict";function OCController(a,b,c,d,e,f,g,h){b.showHeader=!0;var i=null;-1!==c.screenId.indexOf(":")?(i=c.screenId.split(":"),b.screenId=i[1]):(i=c.screenId,b.screenId=i);var j=b.config.templates.metaModel;h.load(a,j),a.checkvisible=function(b){return g.checkVisibility(b,a)},a.doaction=function(b,c,d,e){"navigate"===b&&a.navigate(e)},b.navigate=function(a){d.path(a)}}function showHostErrorMessage(a,b){var c=$("#errorPopup");c.removeClass("alert-error"),c.removeClass("alert-warning"),c.removeClass("alert-info"),"30"===b?c.addClass("alert-error"):"20"===b?c.addClass("alert-remove"):c.addClass("alert-info"),$("#errorMessage").html(a),$("#errorPopup").show()}function loadOptions(a,b,c,d,e,f){if(void 0!==c){var g=b.metamodel[c];if(void 0!==g){var h=g.resourcelist;void 0!==h&&h.length>0&&loadOptionsDataForMetamodel(a,void 0,h,b,d,e,f)}}}function loadOptionsDataForMetamodel(a,b,c,d,e,f,g,h,i,j,k){return void 0!==c&&c.length>0&&angular.forEach(c,function(c){console.log("RESOURCE : "+c);var l,m;if(f.resourceHref)m=f.resourceHref;else{l=d.HostURL+c;var n=d.regionToSoR,o=n[e];m=l.replace(":regionId",o)}console.log("OPTIONS CALL ON : "+m);var p=e+":"+c;void 0===d.optionsMap&&(d.optionsMap=[]);var q=d.optionsMap[p];(j||void 0!==i)&&(q=void 0),void 0===q&&(q=new Map),g.options(m,f.headers).success(function(c){var e,j=c._options.links;if(void 0!==i){var l=c._links[i];if(void 0!==l){var m=l.href;g.options(m,f.headers).success(function(c){var i=c._links.item.href;g.options(i,f.headers).success(function(c){j=c._options.links,setOptionsMapForResource(j,q),d.optionsMap[p]=q,void 0!==h&&(e=q.get(h),void 0!==e&&httpMethodToBackEnd(a,b,d,g,f,e,k))})})}else setOptionsMapForResource(j,q),d.optionsMap[p]=q,void 0!==h&&(e=q.get(h),void 0!==e&&httpMethodToBackEnd(a,b,d,g,f,e,k))}else setOptionsMapForResource(j,q),d.optionsMap[p]=q,void 0!==h&&(e=q.get(h),void 0!==e&&httpMethodToBackEnd(a,b,d,g,f,e,k))})}),"success"}function setOptionsMapForResource(a,b){angular.forEach(a,function(a){var c={};c.action=a.rel,c.url=a.href,c.httpmethod=a.method,c.schema=a.schema,console.log("ACTION : "+c.action),console.log("HTTP METHOD : "+c.httpmethod),console.log("URL : "+c.url),console.log("SCHEMA : "+c.schema),void 0!==b.get(c.action)?b.set(c.action,c):b.set(c.action,c)})}function httpMethodToBackEnd(a,b,c,d,e,f,g){var h=f.url,i=f.httpmethod,j=f.schema,k={};k=setData(c,j,k),"GET"===i?(e.loader.loading=!0,d.get(h,k,e.headers).success(function(a){e.loader.loading=!1,"search"===f.action&&(a._links.item?(c.stTableList=a._links.item,c.displayed=a._links.item,c.stTableList.showResult=!0):(c.stTableList=[],c.displayed=[],c.stTableList.showResult=!1))}).error(function(){e.loader.loading=!1,a.error(e.locale.GET_OPERATION_FAILED)})):"POST"===i?(e.loader.loading=!0,d.post(h,k,e.headers).success(function(b){b&&("us"===e.regionId?void 0!==b._links.self.quoteNumber?(c.data["quote:identifier"]=b._links.self.quoteNumber,c.data["quote:annual_cost"]=b._links.self.premium):a.error(e.locale.CREATE_OPERATION_FAILED):(e.resourceHref=b._links.self.href,e.loader.loading=!1,g&&g()))}).error(function(){e.loader.loading=!1})):"PATCH"===i?(e.loader.loading=!0,d.patch(h,k,e.headers).success(function(a){e.loader.loading=!1,a&&g&&g()}).error(function(){e.loader.loading=!1,a.error(e.locale.PATCH_OPERATION_FAILED)})):"DELETE"===i&&d["delete"](h,e.headers).success(function(d){if("success"===d.outcome){var e=0;angular.forEach(c.stTableList,function(a){b.$$hashKey===a.$$hashKey?c.stTableList.splice(e,1):e+=1}),angular.forEach(d.messages,function(b){a.success(b.message)})}else angular.forEach(d.messages,function(b){a.error(b.message)})})}function loadReferencedMetaModels(a,b,c,d,e,f,g,h,i,j,k){var l,m=[];l=j?"assets/resources/metamodel/regions/"+j+"/":"assets/resources/metamodel/",angular.forEach(c.include,function(b){m.push(f(l+b+".json").get(function(a){h.metamodel[b]=a.metaModel},function(){h.showIcon=!1,a.error(h.appConfig.timeoutMsg)}).$promise)}),g.all(m).then(function(){setScreenData(h,b,c,d,i,e,k)})}function setScreenData(a,b,c,d,e,f,g){var h=c.metamodel,i=h.resourcelist;void 0!==i&&i.length>0&&angular.forEach(i,function(a){b.metamodel[a]=c.metamodel}),a.metamodel=b.metamodel=b.metamodel||{},b.metamodel[d]=c.metamodel,e.notifyWhenNoOutstandingRequests(function(){changeMandatoryColor(a),a.$apply()}),f&&f(c.metamodel),g&&g()}function setData(a,b,c){return void 0!==b&&angular.forEach(b.properties,function(b,d){var e=a.data[d],f=b.type;if(void 0!==f&&"static"===f&&(e=b.value),null===e||void 0===e||""===e||"undefined"===e);else{var g=b.format;void 0!==g&&"date"===g&&(e=formatIntoDate(e)),"object"==typeof e&&(e=void 0!==e.key?e.key:e.value),console.log(d+" : "+e),c[d]=e}}),c}function formatIntoDate(a){return"string"==typeof a?a:a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}function changeMandatoryColor(a){void 0!==a.screenId&&($("#"+a.metamodel[a.screenId].formid+" input[ng-required='true']").css("background-color",a.requiredColor),$("#"+a.metamodel[a.screenId].formid+" select[ng-required='true']").css("background-color",a.requiredColor))}function LoginController(a,b,c,d,e,f,g,h,i,j,k,l){b.screenId="login";var m=b.metamodelPath;l.load(a,m),a.checkvisible=function(b){return j.checkVisibility(b,a)},b.showHeader=!1,a.doaction=function(b,c,d,e,f){"submit"===b&&a.submit(f)},a.submit=function(c){var d=$("form").attr("id");validateLogin(d),$("#"+d).valid()&&(navigator.onLine?i.runLogin(a,c):growl.error(b.locale.NETWORK_UNAVAILABLE,"30"))}}function ScreenController(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){var b=c.metamodel[c.screenId].sections;angular.forEach(b,function(b){a===b.step&&(c.currRel=b.link,c.currName=b.$ref)})}c.enumData={},c.typeaheadData={},c.optionsMap=[],b.checkRegionId=c.regionId,b.showErr=function(){h.error("<b>Error:</b> Uh oh!"),h.info("Im  a info message"),h.warn("Im  a warn message"),h.success("Im  a success message")},screenname="OmniChannel",c.showHeader=!0,b.disableNext=!1,b.rulesDataList=[];var o=null,p=null,q=!1,r=!1;b.data={},b.remove="ban-circle",b.removestyle="red",b.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"1900:2030"},c.typeahead=[],void 0!==f.regionId&&f.regionId.length>0&&(-1!==f.regionId.indexOf(":")?(p=f.regionId.split(":"),c.regionId=p[1],r=!0):(p=f.regionId,c.regionId=p)),-1!==f.screenId.indexOf(":")?(o=f.screenId.split(":"),c.screenId=o[1],q=!0):(o=f.screenId,c.screenId=o),-1!==f.screenId.indexOf("search")&&(c.resourceHref=void 0),c.navigate=function(a,b){c.product_id=b,g.path(a)},b.getEnums=function(a){return c&&c.enumData&&c.enumData[a.name]?c.enumData[a.name]:a.options?a.options:void 0},b.getNamesList=function(a,d,e){if(d){var f=c.HostURL+"persons?"+e+"="+a,g=c.regionToSoR,h=g[c.regionId];f=f.replace(":regionId",h),j.options(f,c.headers).success(function(a){c.typeaheadData[e]=[],b.typeaheadData[e]=[],angular.forEach(a._links.item,function(a){a.summary[e]&&c.typeaheadData[e].push(a.summary[e])}),b.typeaheadData[e]=c.typeaheadData[e]})}},i.setHeaders(c),b.loadTableMetadata=function(a){b.field={},k.load(a.name,function(a){b.field.tableMetaModel=a})},c.navigate=function(a,b){c.product_id=b,g.path(a)},b.checkvisible=function(a){return a.visibleWhen?m.checkVisible(a,b):!0},b.loadMetaModel=function(){c.metamodel={},i.load(b,r?p[1]:p,q?o[1]:o)},b.Injectfactory=function(){b.factoryname=b.screenId+"factory";try{b.factory=e.get(b.factoryname)}catch(a){console.log("Injector does not have "+b.factoryname+" service!")}},c.isPrev=!1,b.loadOptionData=function(){var a=c.resourceHref;void 0===a&&(a=c.HostURL+b.screenId)},b.loadOptionData(),b.stTableList=[],b.displayed=[],b.stTableList.showResult=!0,b.doaction=function(a,d,e,f,g,k){console.log(g);var m=c.screenId,o=c.regionId;if("navigate"===e)c.resourceHref=void 0,c.navigate(f);else if("nextTab"===e){var p=c.step+1,q=b.getRelationshipOfNavigateStep(p);b.selecttab(p,q)}else if("previousTab"===e){var r=c.step-1,s=b.getRelationshipOfNavigateStep(r);b.selecttab(r,s)}else{void 0===k&&(c.resourceHref=void 0),void 0!==f&&c.navigate(f);var t;void 0!==k&&Array.isArray(k)&&(t=k[0]),new Promise(function(a){var c=!1;i.actionHandling(void 0,b,o,m,e,j,t,c,a)}).then(function(){void 0!==k?j.options(c.resourceHref,c.headers).success(function(a){var d=a._links[k[1]].href;j.options(d,c.headers).success(function(a){var d,e=a._links.item;d=Array.isArray(e)?e[0].href:e.href,j.options(d,c.headers).success(function(a){var d=a._links[k[2]].href,e={};j.post(d,e,c.headers).success(function(a){var d;d=Array.isArray(a.messages)?a.messages[a.messages.length-1].message[0]:a.messages.context,j.get(d,e,c.headers).success(function(a){b.data=a,console.log("Compute successfully !!"),c.step=c.step+1,n(c.step),b.preStep=c.step,l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")})}).error(function(){h.error(c.locale.CALC_PREMIUM_OP_FAILED)})})})}):l.loadEnumerationByTab()})}},b.getRelationshipOfNavigateStep=function(a){for(var b=c.metamodel[c.screenId].sections,d=0;d<b.length;d++){var e=b[d];if(a===e.step)return e.link}},c.next=function(){b.next()},b.next=function(){},c.step=1,b.getenumdata=function(){var a="https://oc-sample-dropdown.getsandbox.com/omnichannel/sample/select";j.getData(a).success(function(a){b.enumdata=a})},b.preStep=1,b.preRel=void 0,c.currRel=void 0,c.currName=void 0,new Promise(function(a){i.load(b,r?p[1]:p,q?o[1]:o,a)}).then(function(){if(n(b.preStep),l.loadEnumerationByTab(),"undefined"!==c.currRel&&"itself"!==c.currRel&&"us"!==b.regionId)b.loadDataByTab(c.currRel);else if(void 0!==c.resourceHref){var a={};j.get(c.resourceHref,a,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")}}),b.selecttab=function(a,d){var e=c.screenId,f=c.regionId;b.isValid()&&(c.step=a,c.currRel=d,new Promise(function(a){if(c.step!==b.preStep&&"undefined"!==d){if(n(b.preStep),"us"!==f){var g=!0;i.actionHandling(void 0,b,f,e,"update",j,b.currRel,g,a)}b.preStep=c.step,n(b.preStep)}}).then(function(){if("undefined"!==c.currRel&&"itself"!==c.currRel)b.loadDataByTab(c.currRel);else{var a={};j.get(c.resourceHref,a,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")}}))},b.loadDataByTab=function(a){var d=c.resourceHref;void 0!==d&&j.options(d,c.headers).success(function(d){if(void 0!==d&&void 0!==d._links&&void 0!==d._links[a]){var e=d._links[a].href;j.options(e,c.headers).success(function(a){var d=a._links.item.href,e={};j.get(d,e,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(d,c.headers,"update")})}})},b.isValid=function(){var a=[],d=b.loadmandatoryField(),e=[],f="";return angular.forEach(b.data,function(b,c){""!==b&&void 0!==b&&"_links"!==c&&"_options"!==c&&null!==b&&a.push(c)}),d.forEach(function(b){-1===$.inArray(b,a)&&(console.log(b),e.push(b))}),e.length>0?(e.forEach(function(a){var d=b.translateKeyToLabelByTab(a);f+=c.locale[d]+c.locale.IS_REQD+"<br />"}),h.error(f),!1):!0},b.loadmandatoryField=function(){for(var a=[],b=c.metamodel[c.currName].sections,d=0;d<b.length;d++)for(var e=b[d].elements,f=0;f<e.length;f++){var g=e[f];void 0!==g.required&&"required"===g.required&&a.push(g.name)}return a},b.translateKeyToLabelByTab=function(a){for(var b=c.metamodel[c.currName].sections,d=0;d<b.length;d++)for(var e=b[d].elements,f=0;f<e.length;f++){var g=e[f];if(g.name===a)return g.label}}}function showMessage(a){$("#messageID").html(a),$("#popupdiv").modal("show")}function validateLogin(a){$("#"+a).validate({focusInvalid:!1,onkeyup:!1,onclick:!1,focusCleanup:!1,onfocusout:!1,onfocus:!1,onsubmit:!1,rules:{inputUsername:{required:!0},inputPassword:{required:!0}},messages:{inputUsername:"Username and Password are required.",inputPassword:"Username and Password are required."},errorPlacement:function(a,b){$("#"+b.attr("id")).addClass("highlight")}})}LoginController.$inject=["$scope","$rootScope","$location","$cookieStore","$http","$resource","OCRoles","tmhDynamicLocale","LoginSrv","FieldService","OCInfraConfig","OCMetadata"],ScreenController.$inject=["$http","$scope","$rootScope","$controller","$injector","$routeParams","$location","growl","MetaModel","resourceFactory","TableMetaModel","EnumerationService","CheckVisibleService"],function(a){}(angular.module("bm.bsTour",[])),function(a){a.provider("TourConfig",[function(){var a={prefixOptions:!1,prefix:"bsTour"};this.set=function(b,c){a[b]=c},this.$get=[function(){var b={};return b.get=function(b){return a[b]},b}]}])}(angular.module("bm.bsTour")),function(a){a.controller("TourController",["$filter","$timeout",function(a,b){function c(b){var c=a("orderBy")(b,"order");return angular.forEach(c,function(a,b){a.next=c[b+1]?b+1:-1,a.prev=b-1}),c}var d,e=this,f=[],g=angular.noop,h={};e.refreshTour=function(){f=f.filter(function(a){return a!==h}),f[0]&&f[0].redirectPrev&&f.unshift(h),f[f.length-1]&&f[f.length-1].redirectNext&&f.push(h),d&&(d._options.steps=[],d.addSteps(c(f)))},e.addStep=function(a){~f.indexOf(a)||(f.push(a),e.refreshTour(),g(a))},e.removeStep=function(a){~f.indexOf(a)&&(f.splice(f.indexOf(a),1),e.refreshTour())},e.getSteps=function(){return f},e.waitFor=function(a){d.end(),g=function(c){c.stepId===a&&(d.setCurrentStep(f.indexOf(c)),b(function(){d.start(!0)}))}},e.init=function(a){return a.steps=c(f),d=new Tour(a)}}])}(angular.module("bm.bsTour")),function(a){function b(){return["TourHelpers",function(a){return{restrict:"EA",scope:!0,controller:"TourController",link:function(b,c,d,e){var f,g={},h="onStart onEnd afterGetState afterSetState afterRemoveState onShow onShown onHide onHidden onNext onPrev onPause onResume".split(" "),i="name container keyboard storage debug redirect duration basePath backdrop orphan".split(" ");a.attachInterpolatedValues(d,g,i),a.attachEventHandlers(b,d,g,h),f=a.attachTemplate(b,d,g),b.$watchCollection(e.getSteps,function(a){b.stepCount=a.length}),d.tourOptions&&angular.extend(g,b.$eval(d.tourOptions)),d[a.getAttrName("options")]&&angular.extend(g,b.$eval(d[a.getAttrName("options")])),f.then(function(){b.tour=e.init(g),b.tour.refresh=e.refreshTour})}}}]}a.directive("tour",b()),a.directive("bsTour",b())}(angular.module("bm.bsTour")),function(a){a.factory("TourHelpers",["$templateCache","$http","$compile","TourConfig","$q",function(a,b,c,d,e){function f(a,b){return function(){var d=angular.element(a);return c(d)(b)}}function g(c,d){return b.get(c,{cache:a}).success(function(a){return a?f(a,d):""})}function h(a){return"true"===a?!0:"false"===a?!1:a}var i,j={};return i=j.safeApply=function(a,b){var c=a.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$apply(b)},j.attachTemplate=function(a,b,c){var d,h=e.defer();return b[j.getAttrName("template")]?(d=f(a.$eval(b[j.getAttrName("template")]),a),c.template=d,h.resolve(d)):b[j.getAttrName("templateUrl")]?g(b[j.getAttrName("templateUrl")],a).then(function(a){a&&(c.template=a.data,h.resolve(a))}):h.resolve(),h.promise},j.attachEventHandlers=function(a,b,c,d){angular.forEach(d,function(d){b[j.getAttrName(d)]&&(c[d]=function(c){i(a,function(){a.$eval(b[j.getAttrName(d)])})})})},j.attachInterpolatedValues=function(a,b,c){angular.forEach(c,function(c){a[j.getAttrName(c)]&&(b[c]=h(a[j.getAttrName(c)]),a.$observe(j.getAttrName(c),function(a){b[c]=h(a)}))})},j.getAttrName=function(a){return d.get("prefixOptions")?d.get("prefix")+a.charAt(0).toUpperCase()+a.substr(1):a},j}])}(angular.module("bm.bsTour")),function(a){function b(){return["TourHelpers","$location",function(a,b){return{restrict:"EA",scope:!0,require:"^tour",link:function(c,d,e,f){function g(){var b;return e[a.getAttrName("skip")]&&(b=c.$eval(e[a.getAttrName("skip")])),b||(b=!!l.path||d.is(":hidden")&&!e.availableWhenHidden),b}function h(d,e,g){var h=l[d];l[d]=function(d){h&&h(d),f.waitFor(g),a.safeApply(c,function(){b.path(e)})}}var i,j,k,l={element:d,stepId:e.tourStep},m="onShow onShown onHide onHidden onNext onPrev onPause onResume".split(" "),n="content title path animation container placement backdrop redirect orphan reflex duration nextStep prevStep nextPath prevPath".split(" ");a.attachInterpolatedValues(e,l,n),i=e.$observe(a.getAttrName("order"),function(a){l.order=isNaN(1*a)?0:1*a,f.refreshTour()}),a.attachEventHandlers(c,e,l,m),k=a.attachTemplate(c,e,l),j=c.$watch(g,function(a){a?f.removeStep(l):f.addStep(l)}),c.$on("$destroy",function(){f.removeStep(l),i(),j()}),e[a.getAttrName("options")]&&angular.extend(l,c.$eval(e[a.getAttrName("options")])),l.nextPath&&(l.redirectNext=!0,h("onNext",l.nextPath,l.nextStep)),l.prevPath&&(l.redirectPrev=!0,h("onPrev",l.prevPath,l.prevStep)),k.then(function(){f.addStep(l),c.tourStep=l})}}}]}a.directive("tourStep",b()),a.directive("bsTourStep",b())}(angular.module("bm.bsTour"));var app=angular.module("omnichannel",["ngRoute","ngResource","ui.bootstrap","ngSanitize","ui.select","mgcrea.ngStrap","ngLocale","tmh.dynamicLocale","colorpicker.module","smart-table","ui.date","ui.mask","QuickList","ngCookies","angular-growl"]).config(["$routeProvider","$locationProvider","$httpProvider","tmhDynamicLocaleProvider","growlProvider",function(a,b,c,d,e){e.globalTimeToLive(3e4),e.globalDisableCountDown(!0),e.onlyUniqueMessages(!0),a.when("/",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/login",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/:screenId",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:ScreenController}),d.localeLocationPattern("vendors/angular-i18n/angular-locale_{{locale}}.js")}]);app.run(["$rootScope","$location","$cookieStore","OCInfraConfig",function(a,b,c,d){a.$on("$locationChangeStart",function(){null!==sessionStorage.username&&void 0!==sessionStorage.username||b.url("/")}),a.showHeader=!1,d.load()}]),app.directive("ocLogodir",function(){return{restrict:"E",template:'<div class="oc-logo" style="margin-left: auto;margin-right: auto;"></div>'}}),app.directive("formatDate",function(){return{require:"ngModel",link:function(a,b,c,d){d.$formatters.push(function(a){if(a){var b=new Date(a);return d.$modelValue=b,b}})}}}),app.factory("MetaModel",["$resource","$rootScope","$location","$browser","$q","resourceFactory","growl",function(a,b,c,d,e,f,g){return this.load=function(c,h,i,j,k){var l;c.regionId=h,l=h?"assets/resources/metamodel/regions/"+h+"/"+i+".json":"assets/resources/metamodel/"+i+".json",a(l).get(function(l){c.screenId=i,b.title=l.metamodel.title,l.include&&l.include.length>0?loadReferencedMetaModels(g,c,l,i,j,a,e,b,d,h,k):setScreenData(b,c,l,i,d,j,k),loadOptions(g,c,i,h,b,f)},function(){b.showIcon=!1,g.error(b.appConfig.timeoutMsg)})},this.actionHandling=function(a,c,d,e,f,h,i,j,k){var l=c.metamodel[e];void 0!==l.defaultValue&&angular.forEach(l.defaultValue,function(a){f===a.action&&("Date"===a.value&&(a.value=formatIntoDate(new Date)),c.data[a.field]=a.value)});var m=l.resourcelist;void 0!==m&&m.length>0&&angular.forEach(m,function(e){var l=d+":"+e;void 0===c.optionsMap&&(c.optionsMap=[]);var n=c.optionsMap[l];if((j||void 0!==i)&&(n=void 0),void 0===n)loadOptionsDataForMetamodel(g,a,m,c,d,b,h,f,i,j,k);else{var o=n.get(f);void 0!==o?httpMethodToBackEnd(g,a,c,h,b,o,k):loadOptionsDataForMetamodel(g,a,m,c,d,b,h,f,i,j,k)}})},this.setHeaders=function(a){if(a.headers={Accept:"application/vnd.hal+json, application/json","Content-Type":"application/json"},a.config.securityHeaders)for(var b in a.config.securityHeaders)a.headers[b]=a.config.securityHeaders[b];a.user&&a.user.name&&(a.headers.username=a.user.name)},this}]),app.factory("TableMetaModel",["$resource","$rootScope",function(a,b){return this.load=function(c,d){a("assets/resources/metamodel/table/"+b.regionId+"/"+c+".json").get(function(a){d(a.tableMetaModel)},function(){})},this}]),app.controller("HeaderController",["$scope","$rootScope","$http","$location","$cookieStore","$resource","tmhDynamicLocale",function(a,b,c,d,e,f,g){b.logout=function(){delete b.user,delete localStorage.username,delete c.defaults.headers.common.Authentication,localStorage.clear(),sessionStorage.clear(),e.remove("userid"),b.staticInfo={},d.url("/")},a.setLocate=function(a){b.newlocale=a,angular.forEach(b.localeOpts.options,function(a){a.value===b.newlocale&&(b.selectedLanguage=a.description)}),f("ocInfra/assets/resources/i18n/"+a+".json").get(function(c){b.locale=c,g.set(a)},function(){})},f("assets/resources/metamodel/header.json").get(function(a){b.headermetamodel=a.metamodel},function(){})}]),app.service("LoginSrv",["$rootScope","$resource","$cookieStore","$http","OCRoles","tmhDynamicLocale","growl",function(a,b,c,d,e,f,g){this.runLogin=function(c,h){a.showIcon=!0,d({url:"ocInfra/assets/resources/config/users.json",method:"GET"}).success(function(d){var i=[];if(a.isAuthSuccess=!1,angular.forEach(d.users,function(b){b.name===c.data.inputUsername&&b.password===c.data.inputPassword&&(a.isAuthSuccess=!0,i=b)}),!a.isAuthSuccess)return g.error(a.locale.INVALID_CREDENTIALS),!1;a.user=i,sessionStorage.username=i.name;var j=i.personalizationData.locale;a.newlocale=j,b("ocInfra/assets/resources/i18n/"+a.newlocale+".json").get(function(b){a.locale=b,f.set(a.newlocale),e.load(i.roles[0],h)},function(){})}).error(function(b){a.showIcon=!1,b&&b.exception?g.error(b.exception.message,"30"):g.error(a.locale.GENERAL_ERROR)})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.factory("resourceFactory",["$http",function(a){var b={};return b.getData=function(b){return a.get(b)},b.get=function(b,c,d){var e=a({method:"GET",url:b,params:c,headers:d});return e},b.post=function(b,c,d){var e=a({method:"POST",url:b,headers:d,data:c});return e},b.insert=function(b,c){return a.post(b,c)},b.update=function(b,c){return a.put(b+"/"+c.id,c)},b["delete"]=function(b,c){var d=a({method:"DELETE",url:b,headers:c});return d},b.options=function(b,c){var d=a({method:"GET",url:b,headers:c});return d},b.patch=function(b,c,d){var e=a({method:"PATCH",url:b,headers:d,data:c});return e},b}]);var screenname;app.service("OCInfraConfig",["$resource","$rootScope",function(a,b){this.load=function(){b.infraConfig={},a("ocInfra/assets/resources/config/OCInfraConfig.json").get(function(a){b.infraConfig=a.config.base,b.metamodelPath=a.config.base.templates.metaModel,angular.forEach(b.infraConfig.properties,function(a){"language"===a.name&&(b.localeOpts=angular.fromJson('{"options":'+angular.toJson(a.options)+"}"),angular.forEach(b.localeOpts.options,function(a){a.description=a.description}))})})}}]),app.service("FieldService",function(){this.checkVisibility=function(a,b){return a.visibleWhen?b.data[a.visibleWhen.expression.field]===a.visibleWhen.expression.value?!0:void 0:!0}}),app.service("OCMetadata",["$rootScope","$resource",function(a,b){this.load=function(c,d){var e=a.screenId,f=d+e+".json";a.metamodel={},c.data={},b(f).get(function(b){a.metamodel[e]=b.metamodel,a.title=b.metamodel.title,c.screenId=e})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.service("EnumerationService",["$rootScope","resourceFactory",function(a,b){var c=this;c.loadEnumerationByTab=function(){if(a.resourceHref&&a.currRel)if("itself"===a.currRel){var d=a.resourceHref;c.executeEnumerationFromBackEnd(d,a.headers,"update")}else b.options(a.resourceHref,a.headers).success(function(d){var e=d._links[a.currRel].href;b.options(e,a.headers).success(function(b){var d=b._links.item.href;c.executeEnumerationFromBackEnd(d,a.headers,"update")})})},c.executeEnumerationFromBackEnd=function(c,e,f){b.options(c,e).success(function(b){angular.forEach(b._options.links,function(b){b.rel===f&&angular.forEach(b.schema.properties,function(b,c){b["enum"]&&d(a,b["enum"],c)})})})};var d=function(a,b,c){var d={},f=null;b?(d[c]=e(b),angular.extend(a.enumData,d)):d[c]=a.enumData[c],d[f]=d[c],angular.extend(a.enumData,d)},e=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b};return c}]),app.service("CheckVisibleService",function(){function a(b,c){var d=!0;return b.operator?"AND"===b.operator?angular.forEach(b.conditions,function(b){d&&(d=d&&a(b,c))}):"OR"===b.operator&&(d=!1,angular.forEach(b.conditions,function(b){d||(d=d||a(b,c))})):d=c.data[b.field]===b.value,d}return this.checkVisible=function(b,c){if(b.visibleWhen){var d=a(b.visibleWhen.expression,c);return d}return!0},this}),app.controller("TableController",["$browser","$scope","$rootScope","TableMetaModel","MetaModel","resourceFactory","$location","CheckVisibleService",function(a,b,c,d,e,f,g,h){b.showResult=!0,b.riskDataSet=[],c.rowCollection={},b.loadTableMetadata=function(){d.load(b.field.name,function(a){b.field.tableMetaData=a})},b.checkShow=function(a){return a.visibleWhen?h.checkVisible(a,b):void 0===a.visibleflag?!0:void 0===c.config[a.visibleflag]||c.config[a.visibleflag]===!0},b.doActionItem=function(a,d,g,h){var i=c.screenId,j=c.regionId;c.resourceHref=d.href;var k=!0;e.actionHandling(d,b,j,i,a,f,k),void 0!==h&&c.navigate(h)},b.loadTableMetadata(),b.editItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},b.selectItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},c.navigate=function(a){g.path(a)}}]);