"use strict";function OCController(a,b,c,d,e,f,g,h){b.showHeader=!0;var i=null;-1!==c.screenId.indexOf(":")?(i=c.screenId.split(":"),b.screenId=i[1]):(i=c.screenId,b.screenId=i);var j=b.config.templates.metaModel;h.load(a,j),a.checkvisible=function(b){return g.checkVisibility(b,a)},a.doaction=function(b,c,d,e){"navigate"===b&&a.navigate(e)},b.navigate=function(a){d.path(a)}}function showHostErrorMessage(a,b){var c=$("#errorPopup");c.removeClass("alert-error"),c.removeClass("alert-warning"),c.removeClass("alert-info"),"30"===b?c.addClass("alert-error"):"20"===b?c.addClass("alert-remove"):c.addClass("alert-info"),$("#errorMessage").html(a),$("#errorPopup").show()}function loadOptions(a,b,c,d,e,f){if(void 0!==c){var g=b.metamodel[c];if(void 0!==g){var h=g.resourcelist;void 0!==h&&h.length>0&&loadOptionsDataForMetamodel(a,void 0,h,b,d,e,f)}}}function sanitizeSchema(a,b){return angular.forEach(b.schema.properties,function(c,d){d!==a&&delete b.schema.properties[d]}),b}function loadOptionsDataForMetamodel(a,b,c,d,e,f,g,h,i,j,k){return void 0!==c&&c.length>0&&angular.forEach(c,function(c){console.log("RESOURCE : "+c);var l,m,n;if(d.patchFieldName&&(n=d.patchFieldName),f.resourceHref)m=f.resourceHref;else{l=d.HostURL+c;var o=d.regionToSoR,p=o[e];m=l.replace(":regionId",p),f.resourceHref=m}console.log("OPTIONS CALL ON : "+m);var q=e+":"+c;void 0===d.optionsMap&&(d.optionsMap=[]);var r=d.optionsMap[q];(j||void 0!==i)&&(r=void 0),void 0===r&&(r=new Map),g.options(m,f.headers).success(function(c){var e,j=c._options.links;if(void 0!==i){var l=c._links[i];if(void 0!==l){var m=l.href;g.options(m,f.headers).success(function(c){var i=c._links.item.href;g.options(i,f.headers).success(function(c){j=c._options.links,setOptionsMapForResource(j,r),d.optionsMap[q]=r,void 0!==h&&(e=r.get(h),void 0!==e&&void 0!==n?(e=sanitizeSchema(n,e),httpMethodToBackEnd(a,b,d,g,f,e,k)):k&&k())})})}else setOptionsMapForResource(j,r),d.optionsMap[q]=r,void 0!==h&&(e=r.get(h),void 0!==e&&httpMethodToBackEnd(a,b,d,g,f,e,k))}else setOptionsMapForResource(j,r),d.optionsMap[q]=r,void 0!==h&&(e=r.get(h),void 0!==e&&httpMethodToBackEnd(a,b,d,g,f,e,k))})}),"success"}function setOptionsMapForResource(a,b){angular.forEach(a,function(a){var c={};c.action=a.rel,c.url=a.href,c.httpmethod=a.method,c.schema=a.schema,console.log("ACTION : "+c.action),console.log("HTTP METHOD : "+c.httpmethod),console.log("URL : "+c.url),console.log("SCHEMA : "+c.schema),void 0!==b.get(c.action)?b.set(c.action,c):b.set(c.action,c)})}function convertToArray(a){if(void 0!==a&&void 0===a.length){var b=[];return b.push(a),b}return a}function httpMethodToBackEnd(a,b,c,d,e,f,g){var h=f.url,i=f.httpmethod,j=f.schema;console.log(f.action+" Action : Perform "+i+" operation on URL - "+h+" with following params - ");var k={};k=setData(c,j,k),"GET"===i?(e.loader.loading=!0,d.get(h,k,e.headers).success(function(a){e.loader.loading=!1,"search"===f.action&&(a._links.item?(c.stTableList=convertToArray(a._links.item),c.displayed=a._links.item,c.stTableList.showResult=!0):(c.stTableList=[],c.displayed=[],c.stTableList.showResult=!1))}).error(function(){e.loader.loading=!1,a.error(e.locale.GET_OPERATION_FAILED)})):"POST"===i?(e.loader.loading=!0,d.post(h,k,e.headers).success(function(b){b&&("us"===e.regionId?(void 0!==b._links.self.quoteNumber&&(c.data["quote:identifier"]=b._links.self.quoteNumber,c.data["quote:annual_cost"]=b._links.self.premium),"success"===b.outcome?angular.forEach(b.messages,function(b){a.success(b.message)}):a.error(e.locale.CREATE_OPERATION_FAILED)):(e.resourceHref=b._links.self.href,e.loader.loading=!1,g&&g()))}).error(function(){e.loader.loading=!1})):"PATCH"===i?(e.loader.loading=!0,d.patch(h,k,e.headers).success(function(b){b&&("success"===b.outcome?angular.forEach(b.messages,function(b){a.success(b.message)}):angular.forEach(b.messages,function(b){a.error(b.message)}),e.loader.loading=!1,g&&g())}).error(function(){e.loader.loading=!1,a.error(e.locale.PATCH_OPERATION_FAILED)})):"DELETE"===i&&d["delete"](h,e.headers).success(function(d){if("success"===d.outcome){var e=0;angular.forEach(c.stTableList,function(a){b.$$hashKey===a.$$hashKey?c.stTableList.splice(e,1):e+=1}),angular.forEach(d.messages,function(b){a.success(b.message)})}else angular.forEach(d.messages,function(b){a.error(b.message)})})}function loadReferencedMetaModels(a,b,c,d,e,f,g,h,i,j,k){var l,m=[];l=j?"assets/resources/metamodel/regions/"+j+"/":"assets/resources/metamodel/",angular.forEach(c.include,function(b){m.push(f(l+b+".json").get(function(a){h.metamodel[b]=a.metamodel},function(){h.showIcon=!1,a.error(h.appConfig.timeoutMsg)}).$promise)}),g.all(m).then(function(){setScreenData(h,b,c,d,i,e,k)})}function setScreenData(a,b,c,d,e,f,g){var h=c.metamodel,i=h.resourcelist;a.showHeader=h.showHeader,void 0!==i&&i.length>0&&angular.forEach(i,function(a){b.metamodel[a]=c.metamodel}),a.metamodel=b.metamodel=b.metamodel||{},b.metamodel[d]=c.metamodel,e.notifyWhenNoOutstandingRequests(function(){changeMandatoryColor(a),a.$apply()}),f&&f(c.metamodel),g&&g()}function setData(a,b,c){return void 0!==b&&angular.forEach(b.properties,function(b,d){var e=a.data[d],f=b.type;if(void 0!==f&&"static"===f&&(e=b.value),null===e||void 0===e||""===e||"undefined"===e);else{var g=b.format;void 0!==g&&"date"===g&&(e=formatIntoDate(e)),"object"==typeof e&&(e=void 0!==e.key?e.key:e.value),console.log(d+" : "+e),c[d]=e}}),c}function formatIntoDate(a){return"string"==typeof a?a:a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}function changeMandatoryColor(a){void 0!==a.screenId&&($("#"+a.metamodel[a.screenId].formid+" input[ng-required='true']").css("background-color",a.requiredColor),$("#"+a.metamodel[a.screenId].formid+" select[ng-required='true']").css("background-color",a.requiredColor))}function LoginController(a,b,c,d,e,f,g,h,i,j,k,l){b.screenId="login";var m=b.metamodelPath;l.load(a,m),a.checkvisible=function(b){return j.checkVisibility(b,a)},b.showHeader=!1,a.doaction=function(b,c,d,e,f){"submit"===b&&a.submit(f)},a.submit=function(c){var d=$("form").attr("id");validateLogin(d),$("#"+d).valid()&&(navigator.onLine?i.runLogin(a,c):growl.error(b.locale.NETWORK_UNAVAILABLE,"30"))}}function ScreenController(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){if(void 0!==a&&void 0===a.length){var b=[];return b.push(a),b}return a}function o(a){var b=c.metamodel[c.screenId].sections;angular.forEach(b,function(b){a===b.step&&(c.currRel=b.link,c.currName=b.$ref)})}c.enumData={},c.typeaheadData={},c.optionsMap=[],b.checkRegionId=c.regionId,b.showErr=function(){h.error("<b>Error:</b> Uh oh!"),h.info("Im  a info message"),h.warn("Im  a warn message"),h.success("Im  a success message")},screenname="OmniChannel",b.disableNext=!1,b.rulesDataList=[];var p=null,q=null,r=!1,s=!1;b.data={},b.remove="ban-circle",b.removestyle="red",b.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"1900:2030"},c.typeahead=[],void 0!==f.regionId&&f.regionId.length>0&&(-1!==f.regionId.indexOf(":")?(q=f.regionId.split(":"),c.regionId=q[1],s=!0):(q=f.regionId,c.regionId=q)),-1!==f.screenId.indexOf(":")?(p=f.screenId.split(":"),c.screenId=p[1],r=!0):(p=f.screenId,c.screenId=p),-1===f.screenId.indexOf("search")&&-1===f.screenId.indexOf("dashboard")||(c.resourceHref=void 0),c.navigate=function(a,b){c.product_id=b,g.path(a)},b.getEnums=function(a){return c&&c.enumData&&c.enumData[a.name]?c.enumData[a.name]:a.options?a.options:void 0},b.getNamesList=function(a,d){if(d.typeahead){var e="",f="",g="",h="";if("referential_vehicle:make"===d.typeaheadField)g=d.typeaheadField+"="+a,f=g,e=c.HostURL+"referential_vehicle_makes?"+f;else if("referential_vehicle:model"===d.typeaheadField){h=d.typeaheadField+"="+a;for(var i=c.metamodel[c.currName].sections,k=0;k<i.length;k++)for(var l=i[k].elements,m=0;m<l.length;m++){var o=l[m];o.name===d.enableWhen.expression.field&&void 0!==o.typeaheadField&&null!==o.typeaheadField&&""!==o.typeaheadField&&(g=o.typeaheadField+"="+b.data[d.enableWhen.expression.field]+"&")}f=g+h,e=c.HostURL+"referential_vehicle_models?"+f}else e=c.HostURL+"persons?"+d.typeaheadField+"="+a;var p=c.regionToSoR,q=p[c.regionId];e=e.replace(":regionId",q),j.options(e,c.headers).success(function(a){c.typeaheadData[d.typeaheadField]=[],b.typeaheadData[d.typeaheadField]=[];var e=n(a._links.item);angular.forEach(e,function(a){a.summary[d.typeaheadField]&&c.typeaheadData[d.typeaheadField].push(a.summary[d.typeaheadField])}),b.typeaheadData[d.typeaheadField]=c.typeaheadData[d.typeaheadField]})}},b.checkEnable=function(a){return a.enableWhen?void 0===b.data[a.enableWhen.expression.field]||null===b.data[a.enableWhen.expression.field]||""===b.data[a.enableWhen.expression.field]:!1},i.setHeaders(c),b.loadTableMetadata=function(a){b.field={},k.load(a.name,function(a){b.field.tableMetaModel=a})},c.navigate=function(a,b){c.product_id=b,g.path(a)},b.checkvisible=function(a){return a.visibleWhen?m.checkVisible(a,b):!0},b.Injectfactory=function(){b.factoryname=b.screenId+"factory";try{b.factory=e.get(b.factoryname)}catch(a){console.log("Injector does not have "+b.factoryname+" service!")}},c.isPrev=!1,b.loadOptionData=function(){var a=c.resourceHref;void 0===a&&(a=c.HostURL+b.screenId)},b.loadOptionData(),b.stTableList=[],b.displayed=[],b.stTableList.showResult=!0,b.doaction=function(a,d,e,f,g,k){console.log(g);var m=c.screenId,n=c.regionId;if("navigate"===e){var p=c.metamodel[m].resourcelist,q=c.HostURL+p,r=c.regionToSoR,s=r[n],t=q.replace(":regionId",s);c.resourceHref=t,c.navigate(f)}else if("nextTab"===e){var u=c.step+1,v=b.getRelationshipOfNavigateStep(u);b.selecttab(u,v)}else if("previousTab"===e){var w=c.step-1,x=b.getRelationshipOfNavigateStep(w);b.selecttab(w,x)}else{void 0===k&&(c.resourceHref=void 0),void 0!==f&&c.navigate(f);var y;void 0!==k&&Array.isArray(k)&&(y=k[0]),new Promise(function(a){var c=!1;b.patchFieldName=void 0,i.actionHandling(void 0,b,n,m,e,j,y,c,a)}).then(function(){void 0!==k?j.options(c.resourceHref,c.headers).success(function(a){var d=a._links[k[1]].href;j.options(d,c.headers).success(function(a){var d,e=a._links.item;d=Array.isArray(e)?e[0].href:e.href,j.options(d,c.headers).success(function(a){var d=a._links[k[2]].href,e={};j.post(d,e,c.headers).success(function(a){var d;d=Array.isArray(a.messages)?a.messages[a.messages.length-1].message[0]:a.messages.context,j.get(d,e,c.headers).success(function(a){b.data=a,console.log("Compute successfully !!"),c.step=c.step+1,o(c.step),b.preStep=c.step,l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")})}).error(function(){h.error(c.locale.CALC_PREMIUM_OP_FAILED)})})})}):l.loadEnumerationByTab()})}},b.getRelationshipOfNavigateStep=function(a){for(var b=c.metamodel[c.screenId].sections,d=0;d<b.length;d++){var e=b[d];if(a===e.step)return e.link}},c.next=function(){b.next()},b.next=function(){},c.step=1,b.getenumdata=function(){var a="https://oc-sample-dropdown.getsandbox.com/omnichannel/sample/select";j.getData(a).success(function(a){b.enumdata=a})},b.preStep=1,b.preRel=void 0,c.currRel=void 0,c.currName=void 0,new Promise(function(a){i.load(b,s?q[1]:q,r?p[1]:p,a)}).then(function(){if(o(b.preStep),"us"===c.regionId&&(c.currRel="itself"),l.loadEnumerationByTab(),"undefined"!==c.currRel&&"itself"!==c.currRel&&"us"!==b.regionId)b.loadDataByTab(c.currRel);else if(void 0!==c.resourceHref){var a={};j.get(c.resourceHref,a,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")}}),b.selecttab=function(a,d){if(b.isValid())if(c.step=a,c.currRel=d,o(b.preStep),b.preStep=c.step,o(b.preStep),"undefined"!==c.currRel&&"itself"!==c.currRel)b.loadDataByTab(c.currRel);else{var e={};j.get(c.resourceHref,e,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(c.resourceHref,c.headers,"create")}},b.patchField=function(a){b.patchFieldName=a,"us"!==c.regionId&&b.isValidByField(a)&&i.actionHandling(void 0,b,c.regionId,c.screenId,"update",j,c.currRel,!0)},b.loadDataByTab=function(a){var d=c.resourceHref;void 0!==d&&j.options(d,c.headers).success(function(d){if(void 0!==d&&void 0!==d._links&&void 0!==d._links[a]){var e=d._links[a].href;j.options(e,c.headers).success(function(a){var d=a._links.item.href,e={};j.get(d,e,c.headers).success(function(a){a&&(b.data=a)}),l.executeEnumerationFromBackEnd(d,c.headers,"update")})}})},b.isValid=function(){var a=[],d=b.loadmandatoryField(),e=[],f="";return angular.forEach(b.data,function(b,c){""!==b&&void 0!==b&&"_links"!==c&&"_options"!==c&&null!==b&&a.push(c)}),d.forEach(function(b){-1===$.inArray(b,a)&&(console.log(b),e.push(b))}),e.length>0?(e.forEach(function(a){var d=b.translateKeyToLabelByTab(a);f+=c.locale[d]+c.locale.IS_REQD+"<br />"}),h.error(f),!1):!0},b.isValidByField=function(a){var d="";if(b.isMandatoryField(a)){if(void 0!==b.data[a]&&null!==b.data[a])return!0;var e=b.translateKeyToLabelByTab(a);return d=c.locale[e]+c.locale.IS_REQD,h.error(d),!1}return!0},b.isMandatoryField=function(a){var c=b.loadmandatoryField();return-1!==$.inArray(a,c)},b.loadmandatoryField=function(){for(var a=[],b=c.metamodel[c.currName].sections,d=0;d<b.length;d++)for(var e=b[d].elements,f=0;f<e.length;f++){var g=e[f];void 0!==g.required&&"required"===g.required&&a.push(g.name)}return a},b.translateKeyToLabelByTab=function(a){for(var b=c.metamodel[c.currName].sections,d=0;d<b.length;d++)for(var e=b[d].elements,f=0;f<e.length;f++){var g=e[f];if(g.name===a)return g.label}}}function showMessage(a){$("#messageID").html(a),$("#popupdiv").modal("show")}function validateLogin(a){$("#"+a).validate({focusInvalid:!1,onkeyup:!1,onclick:!1,focusCleanup:!1,onfocusout:!1,onfocus:!1,onsubmit:!1,rules:{inputUsername:{required:!0},inputPassword:{required:!0}},messages:{inputUsername:"Username and Password are required.",inputPassword:"Username and Password are required."},errorPlacement:function(a,b){$("#"+b.attr("id")).addClass("highlight")}})}LoginController.$inject=["$scope","$rootScope","$location","$cookieStore","$http","$resource","OCRoles","tmhDynamicLocale","LoginSrv","FieldService","OCInfraConfig","OCMetadata"],ScreenController.$inject=["$http","$scope","$rootScope","$controller","$injector","$routeParams","$location","growl","MetaModel","resourceFactory","TableMetaModel","EnumerationService","CheckVisibleService"];var app=angular.module("omnichannel",["ngRoute","ngResource","ui.bootstrap","ngSanitize","ui.select","mgcrea.ngStrap","ngLocale","tmh.dynamicLocale","colorpicker.module","smart-table","ui.date","ui.mask","QuickList","ngCookies","angular-growl"]).config(["$routeProvider","$locationProvider","$httpProvider","tmhDynamicLocaleProvider","growlProvider",function(a,b,c,d,e){e.globalTimeToLive(3e4),e.globalDisableCountDown(!0),e.onlyUniqueMessages(!0),a.when("/",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/login",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}).when("/:screenId",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:ScreenController}),d.localeLocationPattern("vendors/angular-i18n/angular-locale_{{locale}}.js")}]);app.run(["$rootScope","$location","$cookieStore","OCInfraConfig",function(a,b,c,d){a.$on("$locationChangeStart",function(){null!==sessionStorage.username&&void 0!==sessionStorage.username||b.url("/")}),a.showHeader=!1,d.load()}]),app.directive("capitalize",function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(a){void 0===a&&(a="");var b=a.toUpperCase();return b!==a&&(d.$setViewValue(b),d.$render()),b};"true"===c.capitalize&&(d.$parsers.push(e),e(a[c.ngModel]))}}}),app.directive("decimalInput",function(){function a(a,b){var c;if(a){if(a+="",a.indexOf(",")>0&&a.indexOf(".")>0)a.lastIndexOf(",")>a.lastIndexOf(".")?(c=a.substring(0,a.lastIndexOf(",")).replace(/,/g,"").replace(/\./g,""),c+=a.substring(a.lastIndexOf(",")).replace(",",".")):(c=a.substring(0,a.lastIndexOf(".")).replace(/,/g,"").replace(/\./g,""),c+=a.substring(a.lastIndexOf(".")));else if(a.indexOf(",")>0)c=a.substring(0,a.lastIndexOf(",")).replace(/,/g,""),c+=a.substring(a.lastIndexOf(","),a.lastIndexOf(",")+b<a.length?a.lastIndexOf(",")+b+1:a.length).replace(",",".");else{if(!(a.indexOf(".")>0))return parseFloat(a);c=a.substring(0,a.lastIndexOf(".")).replace(/\./g,""),c+=a.substring(a.lastIndexOf("."),a.lastIndexOf(".")+b<a.length?a.lastIndexOf(".")+b+1:a.length)}return parseFloat(c)}}var b=/^\$?-?\d+([\.\,]{0,1}\d*){0,1}$/;return{restrict:"A",require:"ngModel",scope:{decimalPrecision:"=?",decimalMin:"=?",decimalMax:"=?"},link:function(c,d,e,f){c.decimalPrecision=c.decimalPrecision||2,c.decimalMin=c.decimalMin||0,c.decimalMax=c.decimalMax||9999999,f.$parsers.unshift(function(d){if(!d||""===d)return f.$setValidity("decimal",!0),d;if(b.test(d)){f.$setValidity("decimal",!0);var e=a(d,c.decimalPrecision);return e<c.decimalMin?(e=c.decimalMin,d=e+""):e>c.decimalMax&&(e=c.decimalMax,d=e+""),isNaN(parseInt(d.charAt(d.length-1)))||0===parseInt(d.charAt(d.length-1))?(d.indexOf(",")>0?d=d.split(",")[1].length>c.decimalPrecision?d.substring(0,d.indexOf(",")+c.decimalPrecision+1):d:d.indexOf(".")>0&&(d=d.split(".")[1].length>c.decimalPrecision?d.substring(0,d.indexOf(".")+c.decimalPrecision+1):d),f.$setViewValue(d),f.$render()):(f.$setViewValue(e+""),f.$render()),e}return 1===d.length&&"-"===d.charAt(0)?d:(isNaN(parseFloat(f.$modelValue))?f.$setViewValue("0"):f.$setViewValue(f.$modelValue+""),f.$render(),f.$modelValue)}),f.$formatters.unshift(function(a){return a?parseFloat(a).toFixed(c.decimalPrecision):void 0})}}}),app.directive("formatDate",["$filter",function(a){return{require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){return a("date")(b,"yyyy-MM-dd")})}}}]),app.directive("inputRender",["$compile","$http","$rootScope","$templateCache","uibButtonConfig","$injector","$location","resourceFactory",function(a,b,c,d,e,f,g,h){return{restrict:"E",replace:"true",scope:{property:"=",metamodel:"=",resources:"=",updateMode:"@",onUpdate:"@",baseUrl:"@"},controller:["$scope",function(a){function b(a,c){if("string"==typeof c){if(c in a)return a[c];if(c.indexOf(".")>0){var d=c.substring(0,c.indexOf("."));if(d in a)return a.$eval(c);if(a.$parent)return b(a.$parent,c)}else if(a.$parent)return a.$parent.resourcesToBind&&c in a.$parent.resourcesToBind.properties?a.$parent.resourcesToBind.properties[c]:b(a.$parent,c)}}function c(a,d,e){var f=!0;if(a.operator)"AND"===a.operator?angular.forEach(a.conditions,function(a){f&&(f=f&&c(a,d,e))}):"OR"===a.operator&&(f=!1,angular.forEach(a.conditions,function(a){f||(f=f||c(a,d,e))}));else if(a.existsInEntity)f=e&&e[a.field]&&null!==e[a.field].value;else{var g;g=e&&e[a.field]?e[a.field]:b(d,a.field);var h=g instanceof Object?g.value:g;f=h===a.value}return f}var d={};d.autocomplete={attributes:{"typeahead-wait-ms":1e3,"typeahead-focus-first":!1,"typeahead-min-length":3,maxlength:9999999,capitalize:!1},options:{_getData:function(a,b,c){if(c.options.getData){if(!c.attributes.capitalize)return c.options.getData({$viewValue:a,id:b,property:c.property,$injector:f});var d=c.options.getData({$viewValue:a,id:b,property:c.property,$injector:f});if(!d.then)return d.map(function(a){return a.toUpperCase()});d.then(function(a){return a.map(function(a){return a.toUpperCase()})})}else console.warn("input.js -> autocomplete_getData(): No getData method for autocomplete input.")},_select:function(a,b,c){c.options.select?c.options.select({$item:a,id:b,property:c.property,$injector:f}):console.warn("input.js -> autocomplete_select(): No select callback for autocomplete input.")},_typeaheadBlur:function(a,b){b.options.typeaheadBlur?b.options.typeaheadBlur({event:a,id:b.id,$injector:f}):a&&a.target&&a.target.attributes&&a.target.attributes["aria-owns"]||console.warn("input.js -> autocomplete_typeaheadBlur(): Typeahead dropdown not found in view.")},_typeaheadFocus:function(a,b){if(b.options.typeaheadFocus)b.options.typeaheadFocus({event:a,id:b.id,$injector:f});else if(a&&a.target&&a.target.attributes&&a.target.attributes["aria-owns"]){var c=document.getElementById(a.target.attributes["aria-owns"].value);angular.element(c).scope().moveInProgress=!1}else console.warn("input.js -> autocomplete_typeaheadFocus(): Typeahead dropdown not found in view.")}}},d.decimal={attributes:{decimalprecision:2,minimum:0,maximum:9999999},options:{}},d.money={attributes:{currency:["eur","usd","gbp","yen","rub","won"],decimalprecision:2,minimum:0,maximum:9999999},options:{}},d.email={attributes:{maxlength:9999999},options:{}},d.number={attributes:{min:0,max:9999999},options:{}},d.percentage={attributes:{decimalprecision:2,minimum:0,maximum:9999999},options:{}},d.select={attributes:{capitalize:!1},options:{_getData:function(a,b){if(!b.options.getData)return b.attributes.capitalize?b.attributes["enum"]&&Array.isArray(b.attributes["enum"])?b.attributes["enum"].map(function(a){return a.toUpperCase()}):[]:b.attributes["enum"];if(!b.attributes.capitalize)return b.options.getData({id:a,property:b.property,$injector:f});var c=b.options.getData({id:a,property:b.property,$injector:f});return c.then?void c.then(function(a){return a.map(function(a){return a.toUpperCase()})}):c.map(function(a){return a.toUpperCase()})}}},d.textMask={attributes:{capitalize:!0,mask:""},options:{}},d.text={attributes:{capitalize:!0,maxlength:9999999},options:{}},d.textarea={attributes:{maxlength:9999999},options:{}},d.toggle={attributes:{true_label:"_TRUE",false_label:"_FALSE"},options:{},updateMode:"change"},d.date={attributes:{dateformat:"dd/MM/yyyy",startWeek:1,trigger:"focus",autoclose:!0},options:{}},d.checkbox={attributes:{},options:{},updateMode:"change"},d.label={attributes:{},options:{}},d.multiselect={attributes:{showcheckbox:!1},options:{_onclick:function(){}}},a.patch=function(b,c){var d={};h.get(b.property.self).then(function(e){for(var f in e)f.indexOf(":")>0&&f.indexOf("_")>0&&f in a.resources&&a.resources[f].value!==e[f]&&(d[f]=a.resources[f].value);Object.keys(d).length>0&&h.patch(b.property.self,d,{}).then(function(){c&&c(b)},function(a){console.error(a),h.refresh(b.property.self,{},{})})})},a.load=function(){e.activeClass="btn-active",void 0!==g.path().split("/screen/")[1]?a.screenFactoryName=g.path().split("/screen/")[1].split("/")[0]+"Factory":a.screenFactoryName=g.path().split("/")[0]+"Factory",a.actionFactory={};try{a.actionFactory=f.get(a.screenFactoryName)}catch(b){console.warn(a.screenFactoryName+" not found")}var h={};h=void 0!==a.properties?a.metamodel.type||a.properties.metainfo.type:a.metamodel.type;var i=a.baseUrl&&""!==a.baseUrl?a.baseUrl:"src/ocInfra/templates/components";a.inputHtmlUrl=i+"/input-"+h+".html",a.updateMode=a.updateMode&&""!==a.updateMode?a.updateMode:d[h].updateMode,a.updateMode=a.updateMode&&""!==a.updateMode?a.updateMode:"blur",a.onUpdate&&""!==a.onUpdate&&!a.update&&(a.update=a.actionFactory[a.onUpdate]),!a.property&&a.resources&&(console.log('input.js -> load(): Property "'+a.metamodel.id+'" not found. Creating it...'),a.resources[a.metamodel.id]={required:!1,editable:!0,metainfo:{},value:a.metamodel.value},a.property=a.resources[a.metamodel.id]),a.field={property:a.property,label:a.metamodel.label,id:a.metamodel.id,name:a.metamodel.name||a.metamodel.id||"",placeholder:a.metamodel.placeholder,onBlur:function(){"blur"===a.updateMode&&(a.metamodel.patchOnBlur?a.patch({id:a.field.id,property:a.field.property,$injector:f,scope:a},a.update):a.update&&a.update({id:a.field.id,property:a.field.property,$injector:f,scope:a}))},onChange:function(){"change"===a.updateMode&&(a.metamodel.patchOnBlur?a.patch({id:a.field.id,property:a.field.property,$injector:f,scope:a},a.update):a.update&&a.update({id:a.field.id,property:a.field.property,$injector:f,scope:a}))},isVisible:function(){return a.metamodel.visible||(a.metamodel.visibleWhen?c(a.metamodel.visibleWhen.expression,a,a.resources):!0)},attributes:{},options:{},labelsize:a.metamodel["label-size"]&&"lg"===a.metamodel["label-size"]?8:4,icon:a.metamodel.icon,"class":a.metamodel["class"],format:a.metamodel.format,tooltip:a.metamodel.tooltip};var j=angular.copy(d[h].attributes);a.field.attributes=j;for(var k in j)j[k]&&Array.isArray(j[k])&&(j[k.toLowerCase()]=j[k][0]);if(void 0!==a.property&&void 0!==a.property.metainfo)for(var l in a.property.metainfo)"type"!==l&&(j[l.toLowerCase()]=a.property.metainfo[l]);if(void 0!==a.metamodel.attributes)for(var m in a.metamodel.attributes)j[m]&&Array.isArray(j[m])?j[m.toLowerCase()]=j[m].indexOf(a.metamodel.attributes[m])>=0?a.metamodel.attributes[m]:j[m][0]:j[m.toLowerCase()]=a.metamodel.attributes[m];var n=angular.copy(d[h].options);a.field.options=n;for(var o in a.metamodel.options){var p=o;do p=0===p.indexOf("_")?p.substring(1):p;while(0===p.indexOf("_"));a.field.options[p]=a.actionFactory[a.metamodel.options[o]]}},a.$watchGroup(["property","metamodel"],function(b){(b[0]&&b[1]||void 0===b[0]&&b[1]&&b[1].uiInput)&&a.load()})}],link:function(e,f){var g=e.$watch("inputHtmlUrl",function(h){h&&(d.get(h)?("Pending"===d.get(h)?c.$on(h,function(b){f.html(d.get(b.name)),a(f.contents())(e)}):(f.html(d.get(h)),a(f.contents())(e)),g()):(d.put(h,"Pending"),b.get(h).then(function(b){d.put(h,b.data),c.$broadcast(h,b.data),f.html(b.data),a(f.contents())(e),g()})))})}}}]),app.directive("popupRender",["MetaModel","$resource","$rootScope","$location","$injector",function(a,b,c,d,e){return{restrict:"E",scope:{uiId:"@",metamodel:"=",resourceUrl:"=",factoryName:"="},controller:["$scope",function(b){function f(){var a=b.metamodelObject.actions&&b.metamodelObject.actions.ok&&b.metamodelObject.actions.ok.callback?b.metamodelObject.actions.ok.callback:null;b.$broadcast("patch_renderer",{resourceUrl:b.resourceUrl||c.resourceUrl,callback:a})}function g(){}function h(){if(b.metamodelObject.actions.reset.links){var a=b.metamodelObject.actions.reset.callback?b.metamodelObject.actions.reset.callback:null;b.$broadcast("reset_renderer",{resourceUrl:b.resourceUrl,links:b.metamodelObject.actions.reset.links,callback:a})}}function i(a){b.metamodelObject=a,j(),k()}function j(){b.popup.labels.title="_POPUP_TITLE",b.popup.labels.ok="_SAVE",b.popup.labels.close="_CLOSE",b.popup.labels.reset="_RESET",b.popup.actions._ok=f,b.popup.actions._close=g,b.popup.actions._reset=h,b.metamodelObject.labels&&(b.popup.labels.title=b.metamodelObject.labels.title||b.popup.labels.title,b.popup.labels.ok=b.metamodelObject.labels.ok||b.popup.labels.ok,b.popup.labels.close=b.metamodelObject.labels.close||b.popup.labels.close,b.popup.labels.cancel=b.metamodelObject.labels.cancel||b.popup.labels.cancel,b.popup.labels.reset=b.metamodelObject.labels.reset||b.popup.labels.reset)}function k(){b.metamodelObject.actions&&(b.popup.actions._ok=b.metamodelObject.actions.ok&&b.metamodelObject.actions.ok.method?b.metamodelObject.actions.ok.method:b.popup.actions._ok,b.popup.actions._close=b.metamodelObject.actions.close&&b.metamodelObject.actions.close.method?b.metamodelObject.actions.close.method:b.popup.actions._close,b.popup.actions._cancel=b.metamodelObject.actions.cancel&&b.metamodelObject.actions.cancel.method?b.metamodelObject.actions.cancel.method:b.popup.actions._cancel,b.popup.actions._reset=b.metamodelObject.actions.reset&&b.metamodelObject.actions.reset.method?b.metamodelObject.actions.reset.method:b.popup.actions._reset)}function l(){if(b.popUpResourceToBind&&b.metamodelObject.actions&&b.metamodelObject.actions.reset)for(var a=0;a<b.metamodelObject.actions.reset.links.length;a++)for(var c=0;c<b.popUpResourceToBind.dependencies.length;c++)if(b.popUpResourceToBind.dependencies[c].resource===b.metamodelObject.actions.reset.links[a])return!1;return!0}b.popup={id:b.uiId||"_popup"+Math.floor(1e12*Math.random()),labels:{},actions:{}},b.resultSet={},b.resetDisabled=!1,b.screenFactoryName=d.path().split("/screen/")[1].split("/")[0]+"Factory";try{b.actionFactory=e.get(b.screenFactoryName)}catch(m){console.log(b.screenFactoryName+"not found")}var n=c.metamodel?c.metamodel[b.metamodel]:null;n?i(n):a.load(c,c.regionId,b.metamodel,function(a){i(a)}),b.$on("resourceDirectory",function(c,d){b.resourceUrl===d.url>=0&&"DELETE"!==d.response.config.method&&(b.resultSet={},a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet))}),b.$watch("resourceUrl",function(){b.metamodelObject&&b.resourceUrl&&a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet)}),b.$watchCollection("resultSet",function(a){if(a[b.resourceUrl]&&a[b.resourceUrl].properties){var c=a[b.resourceUrl].properties[b.metamodelObject.type]?a[b.resourceUrl].properties[b.metamodelObject.type].value:"";c?b.popup.labels.title=c.toUpperCase()+"_"+b.popup.labels.title:b.popup.labels.title=b.popup.labels.title,b.popUpResourceToBind=a[b.resourceUrl],b.resetDisabled=l()}}),b.execute=function(a){b.actionFactory[a]?b.actionFactory[a](b.resultSet[b.resourceUrl],b.resourcesToBind.properties):a()}}],templateUrl:"src/ocInfra/templates/components/popup.html"}}]),angular.module("omnichannel").directive("renderer",["MetaModel","$resource","$rootScope","$injector","resourceFactory","$q",function(a,b,c,d,e,f){return{restrict:"E",scope:{metamodel:"=",resourceUrl:"=",factoryName:"="},link:function(b){function g(a){a&&a.sections&&a.sections.forEach(function(a){if(!a.type||"reference"!==a.type){var b=[];a.rows=[],a.properties.forEach(function(a){void 0!==a.row&&(void 0===b[a.row]&&(b[a.row]=0),b[a.row]++),a.id&&!Array.isArray(a.id)&&(a.id=[a.id])});for(var c=function(a){return void 0!==a.row&&a.row===d?a:void 0},d=0;d<b.length;d++)if(void 0!==b[d]){var e=a.properties.map(c);a.rows.push(e);for(var f=0;f<e.length;f++)if(void 0!==e[f]){a.properties.splice(a.properties.indexOf(e[f]),1);var g=12;a.properties.length>1&&e[f].row&&(g=12/(b[e[f].row]>4?4:b[e[f].row])),e[f].colspan=e[f].colspan||g,a.properties.push(e[f])}}for(var h=a.properties.length-1;h>=0;h--)void 0===a.properties[h].row&&a.rows.unshift([a.properties[h]]);a.rows.forEach(function(a){for(;a.indexOf(void 0)>=0;)a.splice(a.indexOf(void 0),1)})}})}function h(e){b.metamodelObject=e,b.resultSet={},b.boundUrls=[],b.factoryName=b.factoryName||e.factoryName;try{b.actionFactory=d.get(b.factoryName)}catch(f){console.log(b.factoryName+" not found")}b.resourcesToBind={properties:{}},b.resourceUrlToRender=b.resourceUrl||b.metamodelObject.resourceUrl||c.resourceUrl,void 0!==b.resourceUrlToRender&&(b.$watchCollection("resultSet",function(a){if(a){var c={};if(b.resourcesToBind&&b.resourcesToBind.properties)for(var d in b.resourcesToBind.properties)-1===d.indexOf(":")&&(c[d]=b.resourcesToBind.properties[d]);b.resourcesToBind={properties:c};for(var e in a)b.resourcesToBind[a[e].identifier]=a[e];b.boundUrls=[],b.propertiesCollection=[];for(var f=0;f<b.metamodelObject.sections.length;f++)if(!b.metamodelObject.sections[f].type||"reference"!==b.metamodelObject.sections[f].type)for(var g=0;g<b.metamodelObject.sections[f].properties.length;g++)if(Array.isArray(b.metamodelObject.sections[f].properties[g].id))for(var h=b.metamodelObject.sections[f].properties[g].id,j=0;j<h.length;j++){var k={resource:null,points:0};for(var l in b.resourcesToBind)"properties"!==l&&(b.metamodelObject.sections[f].properties[g].selector?i(b.resourcesToBind[l],b.metamodelObject.sections[f].properties[g].selector,k):b.metamodelObject.sections[f].properties[g].id[j]in b.resourcesToBind[l].properties&&(k.resource=l));if(b.resourcesToBind.properties=b.resourcesToBind.properties||{},k.resource&&b.metamodelObject.sections[f].properties[g].id[j]in b.resourcesToBind[k.resource].properties){b.resourcesToBind.properties[b.metamodelObject.sections[f].properties[g].id[j]]=b.resourcesToBind[k.resource].properties[b.metamodelObject.sections[f].properties[g].id[j]],b.boundUrls.indexOf(b.resourcesToBind.properties[b.metamodelObject.sections[f].properties[g].id[j]].self)<0&&b.boundUrls.push(b.resourcesToBind.properties[b.metamodelObject.sections[f].properties[g].id[j]].self);break}}}}),b.$on("resourceDirectory",function(c,d){b.boundUrls.indexOf(d.url)>=0&&"DELETE"!==d.response.config.method&&(b.resultSet={},a.prepareToRender(b.resourceUrlToRender,b.metamodelObject,b.resultSet));
}),a.prepareToRender(b.resourceUrlToRender,b.metamodelObject,b.resultSet))}function i(a,b,c){var d=Array.isArray(b)?b:[b],e=0;return d.forEach(function(b){a.properties[b]&&(e+=2,a.properties[b].value===!0&&(e+=1))}),e>=c.points?(c.resource=a.identifier,c.points=e,!0):!1}var j=c.metamodel?c.metamodel[b.metamodel]:null;j?(g(j),h(j)):a.load(c,c.regionId,b.metamodel,function(a){g(a),h(a)}),b.$watch("resourceUrl",function(a,c){a!==c&&b.metamodelObject&&h(b.metamodelObject)}),b.isVisible=function(a){return void 0!==a},b.execute=function(a,c){b.actionFactory&&b.actionFactory[a]?void 0!==b.resultSet[b.resourceUrlToRender]&&void 0!==b.resourcesToBind.properties?b.actionFactory[a](b.resultSet[b.resourceUrlToRender],b.resourcesToBind.properties):b.actionFactory[a](b,c):b[a]&&b[a](b.resultSet[b.resourceUrlToRender],b.resourcesToBind.properties)},b.$on("patch_renderer",function(a,c){if(c.resourceUrl===b.resourceUrlToRender){var d={},g=[],h=b.resourcesToBind.properties;if(h){for(var i in h)if(h[i]&&h[i].self&&h[i].editable){var j=h[i].self;d[j]=d[j]||{}}var k=Object.keys(d);k.forEach(function(a){e.get(a).then(function(i){var j=i.data,k=d[a];for(var l in j)l.indexOf(":")>0&&0!==l.indexOf("_")&&l in h&&h[l].value!==j[l]&&(k[l]=b.resourcesToBind.properties[l].value?b.resourcesToBind.properties[l].value:null);Object.keys(k).length>0&&(g.push(e.patch(a,k)),f.all(g).then(function(){c.callback&&b.execute(c.callback)}))})})}}}),b.$on("reset_renderer",function(a,c){if(c.resourceUrl===b.resourceUrlToRender){var d={};if(b.resourcesToBind){for(var f in c.links)b.resourcesToBind[c.links[f]]&&(d[c.links[f]]="");e.patch(c.resourceUrl,d)}}}),b.$on("reset_renderer",function(a,c){if(c.resourceUrl===b.resourceUrlToRender){var d={};if(b.resourcesToBind){for(var f in c.links)b.resourcesToBind[c.links[f]]&&(d[c.links[f]]="");e.patch(c.resourceUrl,d).then(function(){c.callback&&b.execute(c.callback)})}}})},templateUrl:"src/ocInfra/templates/components/renderer.html"}}]),angular.module("omnichannel").directive("tableRender",["MetaModel","$resource","$location","$injector","$rootScope","resourceFactory",function(a,b,c,d,e,f){return{restrict:"E",replace:"true",scope:{metamodel:"=",resourceUrl:"=",factoryName:"="},controller:["$scope",function(b){function c(c){b.resultSet={},b.itemSelected={},b.metamodelObject=c;var f=b.metamodelObject.modalRef;if(f){var g=e.metamodel?e.metamodel[f]:null;g?b.modalMetamodelObject=c:a.load(e,e.regionId,f,function(a){b.modalMetamodelObject=a})}b.resourceUrl=b.resourceUrl||b.metamodelObject.resourceUrl,a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet),b.$watchCollection("resultSet",function(a){a&&a[b.resourceUrl]&&(b.items=[],a[b.resourceUrl].items.forEach(function(c){b.items.push(a[c.href])}))}),b.factoryName=b.factoryName||c.factoryName;try{b.actionFactory=d.get(b.factoryName)}catch(h){console.log(b.factoryName+" not found")}}var g=e.metamodel?e.metamodel[b.metamodel]:null;g?c(g):a.load(e,e.regionId,b.metamodel,function(a){c(a)}),b.$on("resourceDirectory",function(c,d){for(var e in b.resultSet)d.url===e&&("DELETE"===d.response.config.method||"PATCH"===d.response.config.method?("DELETE"===d.response.config.method&&delete b.resultSet[d.url],a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet,null,!0)):a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet))}),b.$on("refreshTable",function(c,d){d.name===b.metamodelObject.name&&a.prepareToRender(b.resourceUrl,b.metamodelObject,b.resultSet,null,!0)}),b.execute=function(a,c,d){a.method?b.actionFactory[a.method](c,d):b.metamodelObject.buttonMethod&&a.buttonAction?b.actionFactory[b.metamodelObject.buttonMethod](c,d):b[a.value](c,d)},b.isValidStatus=function(a){var c=!0;if(a){var d=a.properties;b.modalMetamodelObject&&b.modalMetamodelObject.sections.forEach(function(a){a.properties&&a.properties.forEach(function(a){d[a.id]&&(c=c&&d[a.id].consistent)})})}return c},b.edit=function(a){b.itemSelected=a},b.update=function(a,b){if(a.patchable){var c={};c[b.id]=a.properties[b.id].value,f.patch(a.href,c).then(function(){})}},b["delete"]=function(a){a.deletable&&f["delete"](a.href).then(function(){})},b.add=function(){f.get(b.resourceUrl).then(function(a){a.data._options.links.forEach(function(a){if("create"===a.rel){var c=a.href;f.post(c,{},e.headers).then(function(a){var c=a.data._links.self.href;b.edit({href:c}),f.refresh(b.resourceUrl).then(function(){})})}})})}}],link:function(){},templateUrl:"src/ocInfra/templates/components/table.html"}}]),app.directive("ocLogodir",function(){return{restrict:"E",template:'<div class="oc-logo" style="margin-left: auto;margin-right: auto;"></div>'}}),app.directive("formatDate",function(){return{require:"ngModel",link:function(a,b,c,d){d.$formatters.push(function(a){if(a){var b=new Date(a);return d.$modelValue=b,b}})}}}),app.factory("MetaModel",["$resource","$rootScope","$location","$browser","$q","resourceFactory","growl",function(a,b,c,d,e,f,g){function h(a,b){if(!b)return console.warn("No metamodel object to extract business dependencies"),[];if(!b.businessObject)return[];var c=[],d=[];for(var e in a)if(0!==e.indexOf("_")&&e.indexOf(":")>0){var f=e.split(":")[0];-1===d.indexOf(f)&&d.push(f)}return d.forEach(function(d){d in b.businessObject&&b.businessObject[d].forEach(function(b){b in a._links&&c.push({href:a._links[b].href,resource:b})})}),c}function i(a){var b={};if(a&&a._options&&a._embedded){var c,d;a._options.links.forEach(function(a){"update"===a.rel&&(c=a)});for(var e in a._links)"self"===e&&(d=a._links[e].href);for(var f in a._options.properties)"uri"!==a._options.properties[f].format&&(b[f]={},b[f].metainfo=a._options.properties[f],b[f].value=a[f],b[f].self=d,b[f].required=a._options.required&&a._options.required.indexOf(f)>=0,b[f].editable=void 0!==c&&f in c.schema.properties,b[f].statusMessages={information:[],warning:[],error:[],errorCount:0},b[f].consistent=!0);for(var g in a._embedded)if(g.indexOf("status_report")>=0&&a._embedded[g].messages)for(var h=0;h<a._embedded[g].messages.length;h++){var i=a._embedded[g].messages[h];i.context in b&&(b[i.context].statusMessages[i.severity].push(i),"information"!==i.severity&&(b[i.context].consistent=!1,b[i.context].statusMessages.errorCount++))}}return b}function j(a,b){var c=[];if(a&&a._links)for(var d in a._links)if("item"===d){var e=a._links[d];Array.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++){var g=e[f];if(c.push({href:g.href,title:g.title}),g.summary&&b){b[g.href]=k();for(var h in g.summary)b[g.href].properties[h]={value:g.summary[h]}}}}return c}function k(a,b,c){var d={dependencies:[],properties:{},items:[],deletable:!1,patchable:!1,creatable:!1};return a&&a._links&&a._options&&(d.href=a._links.self.href,d.up=a._links.up.href,d.properties=i(a),d.dependencies=h(a,b),d.items=j(a,c),a._options.links.forEach(function(a){"update"===a.rel?d.patchable=!0:"delete"===a.rel?d.deletable=!0:"create"===a.rel&&(d.creatable=!0)})),d}var l=this;return this.load=function(c,h,i,j,k){var l;c.regionId=h,l=h?"assets/resources/metamodel/regions/"+h+"/"+i+".json":"assets/resources/metamodel/"+i+".json",a(l).get(function(l){c.screenId=i,b.title=l.metamodel.title,l.include&&l.include.length>0?loadReferencedMetaModels(g,c,l,i,j,a,e,b,d,h,k):setScreenData(b,c,l,i,d,j,k),loadOptions(g,c,i,h,b,f)},function(){b.showIcon=!1,g.error(b.appConfig.timeoutMsg)})},this.actionHandling=function(a,c,d,e,f,h,i,j,k){var l=c.metamodelObject;void 0!==l.defaultValue&&angular.forEach(l.defaultValue,function(a){f===a.action&&("Date"===a.value&&(a.value=formatIntoDate(new Date)),c.data[a.field]=a.value)});var m=l.resourcelist;void 0!==m&&m.length>0&&angular.forEach(m,function(e){var l=d+":"+e;void 0===c.optionsMap&&(c.optionsMap=[]);var n=c.optionsMap[l];if((j||void 0!==i)&&(n=void 0),void 0===n)loadOptionsDataForMetamodel(g,a,m,c,d,b,h,f,i,j,k);else{var o=n.get(f);void 0!==o?httpMethodToBackEnd(g,a,c,h,b,o,k):loadOptionsDataForMetamodel(g,a,m,c,d,b,h,f,i,j,k)}})},this.setHeaders=function(a){a.headers={Accept:"application/vnd.hal+json, application/json","Content-Type":"application/json"},a.user&&a.user.name&&(a.headers.username=a.user.name)},this.prepareToRender=function(a,b,c,d,e){if(c){var g=f.get;e&&(g=f.refresh);var h=g(a);h.then&&h.then(function(f){var g=f.data||f,h={};if(c[a]=k(g,b,h),c[a].identifier=a.substring(a.lastIndexOf("/")+1),c[a].href=a.substring(0,a.lastIndexOf("/")+1)+c[a].identifier,c[a].identifier=d||c[a].identifier,c[a].dependencies.forEach(function(a){l.prepareToRender(a.href,b,c,a.resource)}),b.summary)for(var i in h)c[i]=h[i],c[i].identifier=i.substring(i.lastIndexOf("/")+1),c[i].href=i;else c[a].items.forEach(function(a){l.prepareToRender(a.href,b,c,null,e)})},function(a){throw console.error(a),a})}},this}]),app.factory("TableMetaModel",["$resource","$rootScope",function(a,b){return this.load=function(c,d){a("assets/resources/metamodel/table/"+b.regionId+"/"+c+".json").get(function(a){d(a.tableMetaModel)},function(){})},this}]),app.controller("HeaderController",["$scope","$rootScope","$http","$location","$cookieStore","$resource","tmhDynamicLocale",function(a,b,c,d,e,f,g){b.logout=function(){delete b.user,delete localStorage.username,delete c.defaults.headers.common.Authentication,localStorage.clear(),sessionStorage.clear(),e.remove("userid"),b.staticInfo={},d.url("/")},a.setLocate=function(a){b.newlocale=a,angular.forEach(b.localeOpts.options,function(a){a.value===b.newlocale&&(b.selectedLanguage=a.description)}),f("ocInfra/assets/resources/i18n/"+a+".json").get(function(c){b.locale=c,g.set(a)},function(){})},f("assets/resources/metamodel/header.json").get(function(a){b.headermetamodel=a.metamodel},function(){})}]),app.service("LoginSrv",["$rootScope","$resource","$cookieStore","$http","OCRoles","tmhDynamicLocale","growl",function(a,b,c,d,e,f,g){this.runLogin=function(c,h){a.showIcon=!0,d({url:"ocInfra/assets/resources/config/users.json",method:"GET"}).success(function(d){var i=[];if(a.isAuthSuccess=!1,angular.forEach(d.users,function(b){b.name===c.data.inputUsername&&b.password===c.data.inputPassword&&(a.isAuthSuccess=!0,i=b)}),!a.isAuthSuccess)return g.error(a.locale.INVALID_CREDENTIALS),!1;a.user=i,sessionStorage.username=i.name;var j=i.personalizationData.locale;a.newlocale=j,b("ocInfra/assets/resources/i18n/"+a.newlocale+".json").get(function(b){a.locale=b,f.set(a.newlocale),e.load(i.roles[0],h)},function(){})}).error(function(b){a.showIcon=!1,b&&b.exception?g.error(b.exception.message,"30"):g.error(a.locale.GENERAL_ERROR)})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.factory("resourceFactory",["$http","$rootScope","$q",function(a,b,c){function d(a){if(void 0===a&&(a={}),b.config.apiGatewayApiKeys)for(var c in b.config.apiGatewayApiKeys)a[c]=b.config.apiGatewayApiKeys[c];return a}function e(e,f,g){f&&Object.keys(f).length>0&&(k[e]=null),f=d(f);var h;return k[e]?(h=c(function(a){k[e]===l?b.$on("resourceDirectory",function(b,c){c.url===e&&a(k[e])}):a(k[e])}),h.success=function(a){var b=a;return h.then(b,null),h},h.error=function(a){var b=a;return h.then(null,b),h}):(k[e]=l,h=a({method:"GET",url:e,params:f,headers:g}),h.then&&h.then(function(a){k[e]=a,b.$broadcast("resourceDirectory",{url:e,response:a})},function(a){throw console.error(a),a})),h}function f(a,b,c){return k[a]=null,e(a,b,c)}function g(c,e,f){var g=d({}),h=a({method:"POST",url:c,headers:f,params:g,data:e});return h.then&&h.then(function(a){k[a.data._links.self.href]=a,b.$broadcast("resourceDirectory",{url:c,response:a})},function(a){throw console.error(a),a}),h}function h(c,e){var f=d({}),g=a({method:"DELETE",url:c,headers:e,params:f});return g.then&&g.then(function(a){k[c]=null,b.$broadcast("resourceDirectory",{url:c,response:a})},function(a){throw console.error(a),a}),g}function i(c,e,f){var g=d({}),h=a({method:"PATCH",url:c,headers:f,params:g,data:e});return h.then&&h.then(function(a){k[c]=a,b.$broadcast("resourceDirectory",{url:c,response:a})},function(a){throw console.error(a),a}),h}function j(c,d,e,f){var g=a({method:f,url:c,headers:e,data:d});return g.then&&g.then(function(a){k[c]=a,b.$broadcast("resourceDirectory",{url:c,response:a})},function(a){throw console.error(a),a}),g}var k={},l="0";return{get:e,refresh:f,post:g,"delete":h,patch:i,execute:j,getData:function(b){return a.get(b)},insert:function(b,c){return a.post(b,c)},update:function(b,c){return a.put(b+"/"+c.id,c)},options:function(b,c){var e=d({}),f=a({method:"GET",url:b,headers:c,params:e});return f}}}]);var screenname;app.service("OCInfraConfig",["$resource","$rootScope",function(a,b){this.load=function(){b.infraConfig={},a("ocInfra/assets/resources/config/OCInfraConfig.json").get(function(a){b.infraConfig=a.config.base,b.metamodelPath=a.config.base.templates.metaModel,angular.forEach(b.infraConfig.properties,function(a){"language"===a.name&&(b.localeOpts=angular.fromJson('{"options":'+angular.toJson(a.options)+"}"),angular.forEach(b.localeOpts.options,function(a){a.description=a.description}))})})}}]),app.service("FieldService",function(){this.checkVisibility=function(a,b){return a.visibleWhen?b.data[a.visibleWhen.expression.field]===a.visibleWhen.expression.value?!0:void 0:!0}}),app.service("OCMetadata",["$rootScope","$resource",function(a,b){this.load=function(c,d){var e=a.screenId,f=d+e+".json";a.metamodel={},c.data={},b(f).get(function(b){a.metamodel[e]=b.metamodel,a.title=b.metamodel.title,c.screenId=e})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.service("EnumerationService",["$rootScope","resourceFactory",function(a,b){var c=this;c.loadEnumerationByTab=function(){if(a.resourceHref&&a.currRel)if("itself"===a.currRel){var d=a.resourceHref;c.executeEnumerationFromBackEnd(d,a.headers,"update")}else b.options(a.resourceHref,a.headers).success(function(d){var e=d._links[a.currRel].href;b.options(e,a.headers).success(function(b){var d=b._links.item.href;c.executeEnumerationFromBackEnd(d,a.headers,"update")})});else void 0!==a.resourceHref&&c.executeEnumerationFromBackEnd(a.resourceHref,a.headers,"search")},c.executeEnumerationFromBackEnd=function(c,e,f){b.options(c,e).success(function(b){angular.forEach(b._options.links,function(b){b.rel===f&&angular.forEach(b.schema.properties,function(b,c){b["enum"]&&d(a,b["enum"],c)})})})};var d=function(a,b,c){var d={},f=null;b?(d[c]=e(b),angular.extend(a.enumData,d)):d[c]=a.enumData[c],d[f]=d[c],angular.extend(a.enumData,d)},e=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b};return c}]),app.service("CheckVisibleService",function(){function a(b,c){var d=!0;return b.operator?"AND"===b.operator?angular.forEach(b.conditions,function(b){d&&(d=d&&a(b,c))}):"OR"===b.operator&&(d=!1,angular.forEach(b.conditions,function(b){d||(d=d||a(b,c))})):d=c.data[b.field]===b.value,d}return this.checkVisible=function(b,c){if(b.visibleWhen){var d=a(b.visibleWhen.expression,c);return d}return!0},this}),app.controller("TableController",["$browser","$scope","$rootScope","TableMetaModel","MetaModel","resourceFactory","$location","CheckVisibleService",function(a,b,c,d,e,f,g,h){b.showResult=!0,b.riskDataSet=[],c.rowCollection={},b.loadTableMetadata=function(){d.load(b.field.name,function(a){b.field.tableMetaData=a})},b.checkShow=function(a){return a.visibleWhen?h.checkVisible(a,b):void 0===a.visibleflag?!0:void 0===c.config[a.visibleflag]||c.config[a.visibleflag]===!0},b.doActionItem=function(a,d,g,h){var i=c.screenId,j=c.regionId;c.resourceHref=d.href;var k=!0;e.actionHandling(d,b,j,i,a,f,k),void 0!==h&&c.navigate(h)},b.loadTableMetadata(),b.editItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},b.selectItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},c.navigate=function(a){g.path(a)}}]);