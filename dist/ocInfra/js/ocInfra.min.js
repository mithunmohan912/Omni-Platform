"use strict";function OCController(a,b,c,d,e,f,g,h){b.showHeader=!0;var i=null;-1!==c.screenId.indexOf(":")?(i=c.screenId.split(":"),b.screenId=i[1]):(i=c.screenId,b.screenId=i);var j=b.config.templates.metaData;h.load(a,j),a.checkvisible=function(b){return g.checkVisibility(b,a)},a.doaction=function(b,c,d,e){"navigate"===b&&a.navigate(e)},b.navigate=function(a){d.path(a)}}function showHostErrorMessage(a,b){var c=$("#errorPopup");c.removeClass("alert-error"),c.removeClass("alert-warning"),c.removeClass("alert-info"),"30"===b?c.addClass("alert-error"):"20"===b?c.addClass("alert-remove"):c.addClass("alert-info"),$("#errorMessage").html(a),$("#errorPopup").show()}function loadReferencedMetaModels(a,b,c,d,e,f,g,h,i,j){var k=[];angular.forEach(b.include,function(a){k.push(g("assets/resources/metadata/"+a+".json").get(function(b){i.metadata[a]=b.metadata},function(){i.showIcon=!1,showMessage(i.appConfig.timeoutMsg)}).$promise)}),h.all(k).then(function(){setScreenData(i,b,c,j,d,f)})}function setScreenData(a,b,c,d,e,f){a.metadata[c]=b.metadata,d.notifyWhenNoOutstandingRequests(function(){changeMandatoryColor(a),a.$apply()}),f&&f(b.metadata)}function changeMandatoryColor(a){void 0!==a.screenId&&($("#"+a.metadata[a.screenId].formid+" input[ng-required='true']").css("background-color",a.requiredColor),$("#"+a.metadata[a.screenId].formid+" select[ng-required='true']").css("background-color",a.requiredColor))}function LoginController(a,b,c,d,e,f,g,h,i,j,k,l){b.screenId="login";var m=b.infraConfig.metaData;l.load(a,m),a.checkvisible=function(b){return j.checkVisibility(b,a)},b.showHeader=!1,a.doaction=function(b,c,d,e,f){"submit"===b&&a.submit(f)},a.submit=function(b){var c=$("form").attr("id");validateLogin(c),$("#"+c).valid()&&(navigator.onLine?i.runLogin(a,b):showMessage("Network is not available","30"))}}function optionsProcessor(a,b,c,d,e,f,g,h){if("search"===e){var i=[];void 0!==a.optionData&&void 0!==a.optionData[f]&&(angular.forEach(a.optionData[f],function(a){"search"===a.rel&&i.push(a)}),h=c.replace("search",""),angular.forEach(i,function(a){var c=a.schema[h],e=c.required;angular.forEach(e,function(a){var c=h.concat(".").concat(a);d[a]=b.data[c]})}))}else if("submit"===e){var j=[];angular.forEach(a.optionData[f],function(a){("create"===a.rel||"update"===a.rel&&"PATCH"===a.method)&&j.push(a)}),h=c.replace("Detail",""),angular.forEach(j,function(a){var c=a.schema[h],d=c.required;angular.forEach(d,function(a){var c=h.concat(".").concat(a);g[a]=b.data[c]}),angular.forEach(c.properties,function(a,d){var e=c.properties[d];if(Array.isArray(e)){var f=e[0],h=[],i=f.required;angular.forEach(i,function(a){var c=d.concat(".").concat(a);h[a]=b.data[c]}),g[d]=h}})})}}function ScreenController(a,b,c,d,e,f,g){function h(a){var c=!0;return c=b.data[a.field]===a.value}screenname="Omnichannel",c.showHeader=!0,b.disableNext=!1;var i={};b.rulesDataList=[];var j=null,k=!1;b.data={},b.remove="ban-circle",b.removestyle="red",b.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"1900:2030"},c.typeahead=[],-1!==d.screenId.indexOf(":")?(j=d.screenId.split(":"),c.screenId=j[1],k=!0):(j=d.screenId,c.screenId=j),c.navigate=function(a,b){c.product_id=b,e.path(a)},c.navigate=function(a,b){c.product_id=b,e.path(a)},b.checkvisible=function(a){if(a.visibleWhen){var b=h(a.visibleWhen.expression);return b}return!0},b.loadMetaData=function(){c.metadata={},f.load(b,k?j[0]:j,i),i&&b.loadData()},b.loadData=function(){if(c.isPrev)return console.log(c.allData),b.data=angular.copy(c.allData),b.disableNext=!1,!0;var a=c.resourceHref,d={"Content-Type":"application/json"};void 0!==a&&(g.options(a,b),g.get(a,d,b))},b.loadMetaData(),c.isPrev=!1,b.loadOptionData=function(){var a=c.resourceHref;void 0===a&&(a=c.HostURL),g.options(a,c)},b.loadOptionData(),b.doaction=function(a,d,e,f){var h,i,k={Accept:"application/json, text/plain, */*","Content-Type":"application/json, text/plain, */*"},l={};if("search"===e){h=c.HostURL,optionsProcessor(c,b,j,l,e,h);var m=angular.element($(".table-striped")).scope();g.search(h,k,l,m),b.listDispScope=m}else if("add"===e)c.resourceHref=void 0,c.navigate(f);else if("submit"===e){var n=!1;a="PATCH",h=c.resourceHref,void 0===h&&(n=!0,a="POST",h=c.HostURL);var o={};i=j.replace("Detail",""),optionsProcessor(c,b,j,l,e,h,o,i),g.addUpdate(a,h,k,o,i)}},b.deleteRow=function(b){var c=angular.element($(".table-striped")).scope(),d=b._link.self.href,e={"Content-Type":"application/json"};a({method:"DELETE",url:d,headers:e,data:{}});var f=0;angular.forEach(c.stTableList,function(a){a.$$hashKey===b.$$hashKey&&c.stTableList.splice(f),f+=1})},c.next=function(){b.next()},b.next=function(){}}function showMessage(a){$("#messageID").html(a),$("#popupdiv").modal("show")}function validateLogin(a){$("#"+a).validate({focusInvalid:!1,onkeyup:!1,onclick:!1,focusCleanup:!1,onfocusout:!1,onfocus:!1,onsubmit:!1,rules:{inputUsername:{required:!0},inputPassword:{required:!0}},messages:{inputUsername:"Username and Password are required.",inputPassword:"Username and Password are required."},errorPlacement:function(a,b){$("#"+b.attr("id")).addClass("highlight")}})}OCController.$inject=["$scope","$rootScope","$routeParams","$location","$http","$resource","FieldService","OCMetadata"];var app=angular.module("omnichannel",["ngRoute","ngResource","ui.bootstrap","ngSanitize","ui.select","mgcrea.ngStrap","ngLocale","tmh.dynamicLocale","colorpicker.module","smart-table","ui.date","ui.mask","QuickList","ngCookies"]).config(["$routeProvider","$locationProvider","$httpProvider","tmhDynamicLocaleProvider",function(a,b,c,d){a.when("/:screenId",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:OCController}).when("/",{templateUrl:function(){return"ocInfra/templates/screen.html"},controller:LoginController}),d.localeLocationPattern("vendors/angular-i18n/angular-locale_{{locale}}.js")}]);app.run(["$rootScope","$location","$cookieStore","OCInfraConfig",function(a,b,c,d){a.$on("$locationChangeStart",function(){(null===c.get("userid")||void 0===c.get("userid"))&&b.url("/")}),a.showHeader=!1,d.load()}]),app.directive("ocLogodir",function(){return{restrict:"E",template:'<div class="oc-logo" style="margin-left: auto;margin-right: auto;"></div>'}}),app.factory("MetaData",["$resource","$rootScope","$location","$browser","$q",function(a,b,c,d,e){return this.load=function(c,f,g,h,i){a("assets/resources/metadata/"+f+".json").get(function(j){c.screenId=f,b.title=j.metadata.title,j.include&&j.include.length>0?loadReferencedMetaModels(c,j,f,g,h,i,a,e,b,d):setScreenData(b,j,f,d,g,i)},function(){b.showIcon=!1,showMessage(b.appConfig.timeoutMsg)})},this}]),app.factory("TableMetaData",["$resource",function(a){return this.load=function(b,c){a("assets/resources/metadata/table/"+b+".json").get(function(a){c&&c(a.tableMetaData)},function(){})},this}]),app.controller("HeaderController",["$scope","$rootScope","$http","$location","$cookieStore","$resource","tmhDynamicLocale",function(a,b,c,d,e,f,g){b.logout=function(){delete b.user,delete localStorage.username,delete c.defaults.headers.common.Authentication,localStorage.clear(),sessionStorage.clear(),e.remove("userid"),b.staticInfo={},d.url("/")},a.setLocate=function(a){b.newlocale=a,angular.forEach(b.localeOpts.options,function(a){a.value===b.newlocale&&(b.selectedLanguage=a.description)}),f("assets/resources/i18n/"+a+".json").get(function(c){b.locale=c,g.set(a)},function(){})}}]),LoginController.$inject=["$scope","$rootScope","$location","$cookieStore","$http","$resource","OCRoles","tmhDynamicLocale","LoginSrv","FieldService","OCInfraConfig","OCMetadata"],app.service("LoginSrv",["$rootScope","$resource","$cookieStore","$http","OCRoles","tmhDynamicLocale",function(a,b,c,d,e,f){this.runLogin=function(g,h){a.showIcon=!0,d({url:"ocInfra/assets/resources/config/users.json",method:"GET"}).success(function(d){var i=[];if(a.isAuthSuccess=!1,angular.forEach(d.users,function(b){b.name===g.data.inputUsername&&b.password===g.data.inputPassword&&(a.isAuthSuccess=!0,i=b)}),!a.isAuthSuccess)return showMessage("Check Username or Password, incorrect Credentials !"),!1;a.user=i,localStorage.username=i.name,localStorage.distributorId=i.distributor_id,c.put("userid",localStorage.username),localStorage.Authentication=i.token;var j=i.personalizationData.locale;a.newlocale=j,b("assets/resources/i18n/"+a.newlocale+".json").get(function(b){a.locale=b,f.set(a.newlocale),e.load(i.roles[0],h)},function(){})}).error(function(b){a.showIcon=!1,b&&b.exception?showMessage(b.exception.message,"30"):showMessage("Unable to connect the server. Please check your internet connection or contact system admin.")})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]);var screenname;app.service("OCInfraConfig",["$resource","$rootScope",function(a,b){this.load=function(){b.infraConfig={},a("ocInfra/assets/resources/config/OCInfraConfig.json").get(function(a){b.infraConfig=a.config.base,b.infraConfig.metaData=a.config.base.templates.metaData})}}]),app.service("FieldService",function(){this.checkVisibility=function(a,b){return a.visibleWhen?b.data[a.visibleWhen.expression.field]===a.visibleWhen.expression.value?!0:void 0:!0}}),app.service("OCMetadata",["$rootScope","$resource",function(a,b){this.load=function(c,d){var e=a.screenId,f=d+e+".json";a.metadata={},c.data={},b(f).get(function(b){a.metadata[e]=b.metadata,a.title=b.metadata.title,c.screenId=e})}}]),app.service("OCRoles",["$resource","$rootScope","$location",function(a,b,c){return this.load=function(d,e){a("ocInfra/assets/resources/config/roles.json").get(function(a){angular.forEach(a.Roles,function(a){void 0!==a[d]&&(b.roleConfig=a[d])}),void 0!==e&&c.path(e)})},this}]),app.service("HttpService",["$http","DataMappingService",function(a,b){return this.options=function(b,c){a({method:"OPTIONS",url:b}).success(function(a){angular.forEach(a,function(a){Array.isArray(a)&&(void 0===c.optionData&&(c.optionData=[]),c.optionData[b]=a)})})},this.search=function(b,c,d,e){a({method:"GET",url:b,headers:c,params:d}).success(function(a){a.item?(e.stTableList=a.item,e.showResult=!0):(e.stTableList=[],e.showResult=!1)})},this.get=function(c,d,e){a({method:"GET",url:c,headers:d}).success(function(a){a&&(e.data=a,b.map(e))})},this.addUpdate=function(b,c,d,e,f){a({method:b,url:c,headers:d,data:e}).success(function(a){if(a){var c=f.charAt(0).toUpperCase()+f.substring(1);showMessage("PATCH"===b?c+" Updated successfully":c+" Added successfully")}})},this}]),app.controller("TableController",["$browser","$scope","$rootScope","TableMetaData","$location",function(a,b,c,d,e){b.showResult=!0,b.riskDataSet=[],c.rowCollection={},b.loadTableMetadata=function(){d.load(b.field.name,function(a){b.field.tableMetaData=a})},b.doActionItem=function(a,d,e,f){var g;"edit"===a?(c.resourceHref=d._link.self.href,c.navigate(f)):"delete"===a&&(g=angular.element($("#"+e)).scope().field,b.deleteRow(d,g))},b.loadTableMetadata(),b.editItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},b.selectItem=function(a,b){c.resourceHref=a._link.self.href,c.navigate(b)},c.navigate=function(a){e.path(a)}}]);